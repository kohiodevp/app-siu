import{a as Q,b as W,c as Z}from"./chunk-TAMGTV3V.js";import"./chunk-JO4DRFJG.js";import{a as _t,b as Mt,c as Ct}from"./chunk-VG5Y5GOD.js";import{a as nt,b as it,c as at,d as ot,e as rt,f as st,g as lt,h as mt,i as ct,j as dt,l as pt}from"./chunk-SFZAX3ZK.js";import{a as ut,b as gt}from"./chunk-EWYNZ3T6.js";import{c as ft,g as ht}from"./chunk-ODKAJW66.js";import"./chunk-474YFGF3.js";import{b as tt,f as et}from"./chunk-QVMFGACW.js";import"./chunk-V6MGZ35S.js";import"./chunk-DEKAXLAX.js";import{a as J,b as Y}from"./chunk-GWNY4E3S.js";import"./chunk-MXRZJWAE.js";import"./chunk-3FMCGYQ4.js";import{a as K}from"./chunk-ISPOGFK5.js";import{a as q}from"./chunk-NQ5JYPMZ.js";import"./chunk-L64YGAYQ.js";import{a as k,b as $,c as z,d as H,f as V,h as U}from"./chunk-HFRGPHGK.js";import"./chunk-M2VBT7VT.js";import{a as F,b as X}from"./chunk-STMJJCCP.js";import{$ as B,W as G}from"./chunk-ZNVG5ZVS.js";import{d as N}from"./chunk-LMV7XNWS.js";import{a as j}from"./chunk-FBCHPQNP.js";import{o as w,p as A}from"./chunk-YGREV7VD.js";import{Cb as y,Db as D,Ib as m,Jb as i,Kb as a,Lb as S,Pb as g,Qb as _,Sb as P,Wb as E,Xa as s,Y as O,Yb as d,ba as C,ga as h,ha as x,kc as o,lb as T,lc as f,mc as M,rb as u,sa as p,tc as L,uc as v,wc as I,zc as R}from"./chunk-E7AQ6X4Y.js";import"./chunk-EQDQRRRY.js";var b=class e{constructor(){this.api=C(j);this.endpoint="/api/mutations"}createMutation(t){return this.api.post(this.endpoint,t)}getMutations(t){return this.api.get(this.endpoint,t)}getMutationById(t){return this.api.get(`${this.endpoint}/${t}`)}getParcelMutations(t){return this.api.get(`${this.endpoint}/parcel/${t}`)}approveMutation(t){return this.api.post(`${this.endpoint}/${t}/approve`,{})}rejectMutation(t,n){return this.api.post(`${this.endpoint}/${t}/reject`,n)}completeMutation(t){return this.api.post(`${this.endpoint}/${t}/complete`,{})}cancelMutation(t){return this.api.post(`${this.endpoint}/${t}/cancel`,{})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"})}};var xt={sale:"Vente",donation:"Donation",inheritance:"H\xE9ritage",exchange:"\xC9change",expropriation:"Expropriation",subdivision:"Subdivision",merge:"Fusion",other:"Autre"},St={pending:"En attente",approved:"Approuv\xE9e",rejected:"Rejet\xE9e",completed:"Compl\xE9t\xE9e",cancelled:"Annul\xE9e"},Et={pending:"warn",approved:"primary",rejected:"warn",completed:"accent",cancelled:""};var vt=()=>[5,10,20,50],Ot=e=>["/parcels",e],Tt=e=>["/mutations",e];function yt(e,t){e&1&&(i(0,"div",13),S(1,"mat-progress-spinner",14),i(2,"p"),o(3,"Chargement des mutations..."),a()())}function Dt(e,t){e&1&&(i(0,"th",29),o(1,"R\xE9f\xE9rence"),a())}function Lt(e,t){if(e&1&&(i(0,"td",30)(1,"a",31),o(2),a()()),e&2){let n=t.$implicit,r=d(2);s(),m("routerLink",v(2,Ot,n.parcel_id)),s(),M(" ",r.getParcelRef(n.parcel_id)," ")}}function It(e,t){e&1&&(i(0,"th",29),o(1,"Type"),a())}function Rt(e,t){if(e&1&&(i(0,"td",30)(1,"mat-chip",32),o(2),a()()),e&2){let n=t.$implicit,r=d(2);s(),m("color",r.getMutationTypeColor(n.mutation_type)),s(),M(" ",r.getMutationTypeLabel(n.mutation_type)," ")}}function wt(e,t){e&1&&(i(0,"th",29),o(1,"Statut"),a())}function At(e,t){if(e&1&&(i(0,"td",30)(1,"mat-chip",32),o(2),a()()),e&2){let n=t.$implicit,r=d(2);s(),m("color",r.getMutationStatusColor(n.status)),s(),M(" ",r.getMutationStatusLabel(n.status)," ")}}function Nt(e,t){e&1&&(i(0,"th",29),o(1,"Prix"),a())}function jt(e,t){if(e&1&&(i(0,"td",30),o(1),I(2,"currency"),a()),e&2){let n=t.$implicit;s(),M(" ",n.price?R(2,1,n.price,"EUR","symbol","1.2-2"):"N/A"," ")}}function kt(e,t){e&1&&(i(0,"th",29),o(1,"Date"),a())}function $t(e,t){if(e&1&&(i(0,"td",30),o(1),a()),e&2){let n=t.$implicit,r=d(2);s(),M(" ",r.formatDate(n.created_at)," ")}}function zt(e,t){e&1&&(i(0,"th",33),o(1,"Actions"),a())}function Ht(e,t){if(e&1){let n=P();i(0,"td",30)(1,"button",34)(2,"mat-icon"),o(3,"visibility"),a()(),i(4,"button",35),E("click",function(){let c=h(n).$implicit,l=d(2);return x(l.approveMutation(c))}),i(5,"mat-icon"),o(6,"check"),a()(),i(7,"button",36),E("click",function(){let c=h(n).$implicit,l=d(2);return x(l.rejectMutation(c))}),i(8,"mat-icon"),o(9,"close"),a()()()}if(e&2){let n=t.$implicit;s(),m("routerLink",v(3,Tt,n.id)),s(3),m("disabled",n.status!=="pending"),s(3),m("disabled",n.status!=="pending")}}function Vt(e,t){e&1&&S(0,"tr",37)}function Ut(e,t){e&1&&S(0,"tr",38)}function Gt(e,t){if(e&1){let n=P();i(0,"div",15)(1,"table",16),g(2,17),u(3,Dt,2,0,"th",18)(4,Lt,3,4,"td",19),_(),g(5,20),u(6,It,2,0,"th",18)(7,Rt,3,2,"td",19),_(),g(8,21),u(9,wt,2,0,"th",18)(10,At,3,2,"td",19),_(),g(11,22),u(12,Nt,2,0,"th",18)(13,jt,3,6,"td",19),_(),g(14,23),u(15,kt,2,0,"th",18)(16,$t,2,1,"td",19),_(),g(17,24),u(18,zt,2,0,"th",25)(19,Ht,10,5,"td",19),_(),u(20,Vt,1,0,"tr",26)(21,Ut,1,0,"tr",27),a()(),i(22,"mat-paginator",28),E("page",function(c){h(n);let l=d();return x(l.onPageChange(c))}),a()}if(e&2){let n=d();s(),m("dataSource",n.mutations()),s(19),m("matHeaderRowDef",n.displayedColumns()),s(),m("matRowDefColumns",n.displayedColumns()),s(),m("length",n.totalItems())("pageSize",n.pageSize())("pageSizeOptions",L(6,vt))}}var bt=class e{constructor(){this.mutationService=C(b);this.dialog=C(ft);this.loading=p(!0);this.mutations=p([]);this.totalItems=p(0);this.pageSize=p(10);this.currentPage=p(1);this.stats=p({pending:0,approved:0,rejected:0,completed:0});this.displayedColumns=p(["parcel_ref","mutation_type","status","price","created_at","actions"])}ngOnInit(){this.loadMutations(),this.calculateStats()}loadMutations(){this.loading.set(!0),this.mutationService.getMutations({page:this.currentPage(),page_size:this.pageSize()}).subscribe({next:t=>{this.mutations.set(t.items),this.totalItems.set(t.total),this.loading.set(!1),this.calculateStats()},error:t=>{console.error("Erreur lors du chargement des mutations:",t),this.loading.set(!1)}})}calculateStats(){let t=this.mutations(),n={pending:t.filter(r=>r.status==="pending").length,approved:t.filter(r=>r.status==="approved").length,rejected:t.filter(r=>r.status==="rejected").length,completed:t.filter(r=>r.status==="completed").length};this.stats.set(n)}getMutationTypeLabel(t){return xt[t]||t}getMutationStatusLabel(t){return St[t]||t}getMutationTypeColor(t){return"primary"}getMutationStatusColor(t){return Et[t]||"primary"}getParcelRef(t){return`PAR-${t.substring(0,6)}`}formatDate(t){return new Date(t).toLocaleDateString("fr-FR")}approveMutation(t){this.mutationService.approveMutation(t.id).subscribe({next:n=>{let c=this.mutations().map(l=>l.id===t.id?n:l);this.mutations.set(c),this.calculateStats()},error:n=>{console.error("Erreur lors de l'approbation:",n)}})}rejectMutation(t){this.mutationService.rejectMutation(t.id,{reason:"Rejet\xE9 par l'administrateur"}).subscribe({next:n=>{let c=this.mutations().map(l=>l.id===t.id?n:l);this.mutations.set(c),this.calculateStats()},error:n=>{console.error("Erreur lors du rejet:",n)}})}onPageChange(t){this.currentPage.set(t.pageIndex+1),this.pageSize.set(t.pageSize),this.loadMutations()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=T({type:e,selectors:[["app-mutation-list"]],decls:68,vars:6,consts:[[1,"mutation-dashboard"],[1,"dashboard-header"],[1,"stats-section"],["cols","4","rowHeight","120px","gutterSize","16px"],[1,"stat-card"],[1,"stat-content"],[1,"stat-icon","primary"],[1,"stat-info"],[1,"stat-icon","success"],[1,"stat-icon","error"],[1,"stat-icon","accent"],[1,"mutations-section"],[1,"mutations-card"],[1,"loading-container"],["mode","indeterminate"],[1,"mutations-table-container"],["mat-table","","matSort","",1,"mat-elevation-z8","mutations-table",3,"dataSource"],["matColumnDef","parcel_ref"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","mutation_type"],["matColumnDef","status"],["matColumnDef","price"],["matColumnDef","created_at"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"parcel-link",3,"routerLink"],["selected","",3,"color"],["mat-header-cell",""],["mat-icon-button","","matTooltip","D\xE9tails",3,"routerLink"],["mat-icon-button","","matTooltip","Approuver",3,"click","disabled"],["mat-icon-button","","matTooltip","Rejeter",3,"click","disabled"],["mat-header-row",""],["mat-row",""]],template:function(n,r){n&1&&(i(0,"div",0)(1,"header",1)(2,"h1")(3,"mat-icon"),o(4,"swap_horiz"),a(),i(5,"span"),o(6,"Gestion des Mutations"),a()(),i(7,"p"),o(8,"Gestion des transferts de droits fonciers"),a()(),i(9,"section",2)(10,"mat-grid-list",3)(11,"mat-grid-tile")(12,"mat-card",4)(13,"mat-card-content",5)(14,"div",6)(15,"mat-icon"),o(16,"pending_actions"),a()(),i(17,"div",7)(18,"h3"),o(19),a(),i(20,"p"),o(21,"En attente"),a()()()()(),i(22,"mat-grid-tile")(23,"mat-card",4)(24,"mat-card-content",5)(25,"div",8)(26,"mat-icon"),o(27,"check_circle"),a()(),i(28,"div",7)(29,"h3"),o(30),a(),i(31,"p"),o(32,"Approuv\xE9es"),a()()()()(),i(33,"mat-grid-tile")(34,"mat-card",4)(35,"mat-card-content",5)(36,"div",9)(37,"mat-icon"),o(38,"cancel"),a()(),i(39,"div",7)(40,"h3"),o(41),a(),i(42,"p"),o(43,"Rejet\xE9es"),a()()()()(),i(44,"mat-grid-tile")(45,"mat-card",4)(46,"mat-card-content",5)(47,"div",10)(48,"mat-icon"),o(49,"done_all"),a()(),i(50,"div",7)(51,"h3"),o(52),a(),i(53,"p"),o(54,"Compl\xE9t\xE9es"),a()()()()()()(),i(55,"section",11)(56,"mat-card",12)(57,"mat-card-header")(58,"mat-card-title")(59,"mat-icon"),o(60,"list_alt"),a(),i(61,"span"),o(62,"Mutations de Parcelles"),a()(),i(63,"mat-card-subtitle"),o(64),a()(),i(65,"mat-card-content"),y(66,yt,4,0,"div",13)(67,Gt,23,7),a()()()()),n&2&&(s(19),f(r.stats().pending),s(11),f(r.stats().approved),s(11),f(r.stats().rejected),s(11),f(r.stats().completed),s(12),M("",r.mutations().length," mutations trouv\xE9es"),s(2),D(r.loading()?66:67))},dependencies:[A,N,U,k,z,V,H,$,Z,W,Q,X,F,B,G,K,q,pt,nt,at,lt,ot,it,mt,rt,st,ct,dt,gt,ut,Ct,_t,Mt,et,tt,Y,J,ht,w],styles:[".mutation-dashboard[_ngcontent-%COMP%]{padding:24px;max-width:1400px;margin:0 auto}.dashboard-header[_ngcontent-%COMP%]{margin-bottom:24px}.dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin:0 0 8px;font-size:24px;font-weight:500;color:#1a237e}.dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#1976d2}.dashboard-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666}.stats-section[_ngcontent-%COMP%]{margin-bottom:24px}.stat-card[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center}.stat-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;width:100%;height:100%}.stat-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:50px;height:50px;border-radius:50%;color:#fff}.stat-icon.primary[_ngcontent-%COMP%]{background-color:#1976d2}.stat-icon.success[_ngcontent-%COMP%]{background-color:#4caf50}.stat-icon.error[_ngcontent-%COMP%]{background-color:#f44336}.stat-icon.accent[_ngcontent-%COMP%]{background-color:#ff9800}.stat-info[_ngcontent-%COMP%]{flex:1}.stat-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:500;color:#333}.stat-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#666}.mutations-section[_ngcontent-%COMP%]{margin-bottom:24px}.mutations-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:16px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 0}.loading-container[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{margin-bottom:16px}.mutations-table-container[_ngcontent-%COMP%]{overflow-x:auto;margin-bottom:16px}.mutations-table[_ngcontent-%COMP%]{width:100%}.mutations-table[_ngcontent-%COMP%]   .parcel-link[_ngcontent-%COMP%]{text-decoration:none;color:#1976d2;font-weight:500}.mutations-table[_ngcontent-%COMP%]   .parcel-link[_ngcontent-%COMP%]:hover{text-decoration:underline}@media(max-width:1024px){mat-grid-list[_ngcontent-%COMP%]   mat-grid-tile[_ngcontent-%COMP%]{height:100px!important}}@media(max-width:768px){.mutation-dashboard[_ngcontent-%COMP%]{padding:16px}.mutations-table[_ngcontent-%COMP%]{font-size:.8em}.mat-mdc-cell[_ngcontent-%COMP%]{padding:8px 4px}}"],changeDetection:0})}};export{bt as MutationListComponent};
