import{A as h,u as d,v as c}from"./chunk-3AYM6UTQ.js";import{U as a,Y as l,ba as p,p as n}from"./chunk-E7AQ6X4Y.js";var b=class s{constructor(){this.http=p(c);this.apiUrl=`${h.apiUrl}/api/reports`}generateParcelReportPDF(t,e=!0,r=!0,o=!1){return this.http.get(`${this.apiUrl}/parcel/${t}/pdf`,{params:{include_history:e.toString(),include_documents:r.toString(),include_map:o.toString()},responseType:"blob"})}generateActivityReportPDF(t=30,e){let r={days:t.toString()};return e&&(r.user_id=e.toString()),this.http.get(`${this.apiUrl}/activity/pdf`,{params:r,responseType:"blob"})}generateAuditReportPDF(t=30){return this.http.get(`${this.apiUrl}/audit/pdf`,{params:{days:t.toString()},responseType:"blob"})}exportParcelsToExcel(t,e){let r={};return t&&(r.zone=t),e&&(r.status=e),this.http.get(`${this.apiUrl}/export/parcels/excel`,{params:r,responseType:"blob"})}exportDocumentsToExcel(t){let e={};return t&&(e.parcel_id=t),this.http.get(`${this.apiUrl}/export/documents/excel`,{params:e,responseType:"blob"})}downloadParcelReport(t,e={}){let r=e.includeHistory??!0,o=e.includeDocuments??!0,i=e.includeMap??!1;return this.http.get(`${this.apiUrl}/parcel/${t}/pdf`,{params:{include_history:r.toString(),include_documents:o.toString(),include_map:i.toString()},responseType:"blob"}).pipe(a(u=>this.downloadBlob(u,`parcelle_${t}_report.pdf`)),n(()=>{}))}downloadActivityReport(t=30,e){return this.generateActivityReportPDF(t,e).pipe(a(r=>this.downloadBlob(r,`activity_report_${t}d.pdf`)),n(()=>{}))}downloadParcelsExcel(t,e){return this.exportParcelsToExcel(t,e).pipe(a(r=>this.downloadBlob(r,`parcelles_export_${new Date().toISOString().split("T")[0]}.xlsx`)),n(()=>{}))}downloadDocumentsExcel(t){return this.exportDocumentsToExcel(t).pipe(a(e=>this.downloadBlob(e,`documents_export_${new Date().toISOString().split("T")[0]}.xlsx`)),n(()=>{}))}downloadBlob(t,e){let r=window.URL.createObjectURL(t),o=document.createElement("a");o.href=r,o.download=e,o.click(),window.URL.revokeObjectURL(r)}getReportHistory(t,e=50){let r=new d().set("limit",e.toString());return t&&(r=r.set("user_id",t)),this.http.get(`${this.apiUrl}/history`,{params:r})}downloadReport(t,e){return this.http.get(`${this.apiUrl}/history/${t}/download`,{responseType:"blob"}).pipe(a(r=>{let o=window.URL.createObjectURL(r),i=document.createElement("a");i.href=o,i.download=e,i.click(),window.URL.revokeObjectURL(o)}))}scheduleReport(t){return this.http.post(`${this.apiUrl}/schedule`,t)}deleteReport(t){return this.http.delete(`${this.apiUrl}/history/${t}`)}getReportTemplates(){return this.http.get(`${this.apiUrl}/templates`)}getReportDetails(t){return this.http.get(`${this.apiUrl}/history/${t}`)}generateMockReportHistory(){let t=["parcel","activity","audit","export"],e=["PDF","Excel"],r=["completed","pending","failed"];return Array.from({length:15},(o,i)=>({id:(i+1).toString(),type:t[Math.floor(Math.random()*t.length)],title:this.generateReportTitle(t[Math.floor(Math.random()*t.length)]),format:e[Math.floor(Math.random()*e.length)],status:r[Math.floor(Math.random()*r.length)],size:Math.floor(Math.random()*5e3)+100,createdAt:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString(),generatedBy:`user_${Math.floor(Math.random()*10)+1}`}))}generateReportTitle(t){return{parcel:"Rapport de parcelle #"+Math.floor(Math.random()*1e3),activity:"Rapport d'activit\xE9 - "+Math.floor(Math.random()*90+7)+" jours",audit:"Rapport d'audit - "+Math.floor(Math.random()*90+7)+" jours",export:"Export de donn\xE9es - "+new Date().toLocaleDateString("fr-FR")}[t]||"Rapport"}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})}};export{b as a};
