import{a as me}from"./chunk-2XBNJKWF.js";import{a as oe,b as le}from"./chunk-HD4V77CK.js";import{b as W,c as X}from"./chunk-E7OICD5F.js";import{a as Q}from"./chunk-OFBHONAA.js";import{b as j,c as H,d as K,e as $,i as J}from"./chunk-YPBVTN56.js";import{a as ne,b as ie}from"./chunk-3WYC6ROS.js";import{a as re,b as ae}from"./chunk-XMY2MG46.js";import"./chunk-QDNYLZKO.js";import{a as R,c as z,f as G,h as V}from"./chunk-FY6NZ6SC.js";import{b as U,d as s,g as k,h as D,k as T,m as B,n as A,s as L,u as q}from"./chunk-4TEKNYBZ.js";import{a as ee,b as te}from"./chunk-UUJ2B6HP.js";import{a as N}from"./chunk-XNCRNYUB.js";import{$ as Z,Y}from"./chunk-AQZ5PN4T.js";import"./chunk-JWWLDGKM.js";import"./chunk-NYFRATJG.js";import{p as I}from"./chunk-3AYM6UTQ.js";import{Cb as d,Db as p,Ib as u,Jb as t,Kb as e,Lb as m,Wb as v,Xa as l,Yb as y,ba as g,kc as n,lb as w,lc as f,mc as F,nc as O,sa as _}from"./chunk-E7AQ6X4Y.js";import"./chunk-EQDQRRRY.js";function de(o,r){if(o&1&&(t(0,"span",6),n(1),e()),o&2){let a=y();l(),f(a.getRoleLabel(a.currentUser().role))}}function pe(o,r){o&1&&(t(0,"mat-error"),n(1,"Email invalide"),e())}function ce(o,r){o&1&&m(0,"mat-spinner",19)}function ue(o,r){o&1&&(t(0,"mat-icon"),n(1,"save"),e())}function fe(o,r){o&1&&(t(0,"mat-error"),n(1,"Au moins 8 caract\xE8res requis"),e())}function ge(o,r){o&1&&(t(0,"mat-error"),n(1,"Les mots de passe ne correspondent pas"),e())}function _e(o,r){o&1&&m(0,"mat-spinner",19)}function ve(o,r){o&1&&(t(0,"mat-icon"),n(1,"vpn_key"),e())}var se=class o{constructor(){this.fb=g(L);this.authService=g(N);this.userService=g(me);this.snackBar=g(re);this.currentUser=this.authService.currentUser;this.saving=_(!1);this.changingPassword=_(!1);this.profileForm=this.fb.group({username:[{value:"",disabled:!0}],email:["",[s.required,s.email]],first_name:["",s.required],last_name:["",s.required]});this.passwordForm=this.fb.group({current_password:["",s.required],new_password:["",[s.required,s.minLength(8)]],confirm_password:["",s.required]},{validators:this.passwordMatchValidator});let r=this.currentUser();r&&this.profileForm.patchValue({username:r.username,email:r.email,first_name:r.first_name||"",last_name:r.last_name||""})}getInitials(){let r=this.currentUser();if(!r)return"?";if(r.first_name){let a=r.first_name.split(" ");return a.length>=2?`${a[0][0]}${a[1][0]}`.toUpperCase():a[0][0].toUpperCase()}return r.username[0].toUpperCase()}getRoleLabel(r){return r?{administrator:"Administrateur",manager:"Gestionnaire",officer:"Agent",citizen:"Citoyen",consultant:"Consultant"}[r]||r:"N/A"}formatDate(r){return r?new Date(r).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}):"N/A"}saveProfile(){if(!this.profileForm.valid||!this.currentUser())return;this.saving.set(!0);let r=this.currentUser().id,a={email:this.profileForm.value.email,first_name:this.profileForm.value.first_name};this.userService.updateUser(r,a).subscribe({next:i=>{this.saving.set(!1),this.profileForm.markAsPristine(),this.snackBar.open("Profil mis \xE0 jour avec succ\xE8s","OK",{duration:3e3}),i.user&&this.authService.updateCurrentUser(i.user)},error:i=>{this.saving.set(!1),this.snackBar.open("Erreur lors de la mise \xE0 jour du profil","Fermer",{duration:5e3}),console.error("Profile update error:",i)}})}changePassword(){if(!this.passwordForm.valid)return;this.changingPassword.set(!0);let r={current_password:this.passwordForm.value.current_password,new_password:this.passwordForm.value.new_password};this.userService.changeMyPassword(r).subscribe({next:()=>{this.changingPassword.set(!1),this.passwordForm.reset(),this.snackBar.open("Mot de passe chang\xE9 avec succ\xE8s","OK",{duration:3e3})},error:a=>{this.changingPassword.set(!1);let i=a.error?.detail||"Erreur lors du changement de mot de passe";this.snackBar.open(i,"Fermer",{duration:5e3}),console.error("Password change error:",a)}})}passwordMatchValidator(r){let a=r.get("new_password")?.value,i=r.get("confirm_password")?.value;return a!==i?{passwordMismatch:!0}:null}static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275cmp=w({type:o,selectors:[["app-profile"]],decls:123,vars:18,consts:[[1,"profile-container"],[1,"profile-card"],[1,"profile-header"],[1,"avatar"],[1,"user-info"],[1,"email"],[1,"role-badge"],[1,"section"],[3,"ngSubmit","formGroup"],[1,"form-grid"],["appearance","outline"],["matInput","","formControlName","last_name"],["matPrefix",""],["matInput","","formControlName","first_name"],["matInput","","type","email","formControlName","email"],["matInput","","formControlName","username","readonly",""],["matInput","","readonly","",3,"value"],[1,"actions"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20"],["matInput","","type","password","formControlName","current_password"],["matInput","","type","password","formControlName","new_password"],["matInput","","type","password","formControlName","confirm_password"],["mat-raised-button","","color","accent","type","submit",3,"disabled"],[1,"info-grid"],[1,"info-item"]],template:function(a,i){if(a&1&&(t(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"div",2)(4,"div",3),n(5),e(),t(6,"div",4)(7,"h1"),n(8),e(),t(9,"p",5),n(10),e(),d(11,de,2,1,"span",6),e()()(),t(12,"mat-card-content"),m(13,"mat-divider"),t(14,"section",7)(15,"h2")(16,"mat-icon"),n(17,"person"),e(),n(18," Informations personnelles "),e(),t(19,"form",8),v("ngSubmit",function(){return i.saveProfile()}),t(20,"div",9)(21,"mat-form-field",10)(22,"mat-label"),n(23,"Nom"),e(),m(24,"input",11),t(25,"mat-icon",12),n(26,"badge"),e()(),t(27,"mat-form-field",10)(28,"mat-label"),n(29,"Pr\xE9nom"),e(),m(30,"input",13),t(31,"mat-icon",12),n(32,"badge"),e()(),t(33,"mat-form-field",10)(34,"mat-label"),n(35,"Email"),e(),m(36,"input",14),t(37,"mat-icon",12),n(38,"email"),e(),d(39,pe,2,0,"mat-error"),e(),t(40,"mat-form-field",10)(41,"mat-label"),n(42,"Nom d'utilisateur"),e(),m(43,"input",15),t(44,"mat-icon",12),n(45,"account_circle"),e(),t(46,"mat-hint"),n(47,"Le nom d'utilisateur ne peut pas \xEAtre modifi\xE9"),e()(),t(48,"mat-form-field",10)(49,"mat-label"),n(50,"R\xF4le"),e(),m(51,"input",16),t(52,"mat-icon",12),n(53,"security"),e()()(),t(54,"div",17)(55,"button",18),d(56,ce,1,0,"mat-spinner",19)(57,ue,2,0,"mat-icon"),n(58," Enregistrer "),e()()()(),m(59,"mat-divider"),t(60,"section",7)(61,"h2")(62,"mat-icon"),n(63,"lock"),e(),n(64," Changer le mot de passe "),e(),t(65,"form",8),v("ngSubmit",function(){return i.changePassword()}),t(66,"div",9)(67,"mat-form-field",10)(68,"mat-label"),n(69,"Mot de passe actuel"),e(),m(70,"input",20),t(71,"mat-icon",12),n(72,"lock_open"),e()(),t(73,"mat-form-field",10)(74,"mat-label"),n(75,"Nouveau mot de passe"),e(),m(76,"input",21),t(77,"mat-icon",12),n(78,"lock"),e(),d(79,fe,2,0,"mat-error"),e(),t(80,"mat-form-field",10)(81,"mat-label"),n(82,"Confirmer le mot de passe"),e(),m(83,"input",22),t(84,"mat-icon",12),n(85,"lock"),e(),d(86,ge,2,0,"mat-error"),e()(),t(87,"div",17)(88,"button",23),d(89,_e,1,0,"mat-spinner",19)(90,ve,2,0,"mat-icon"),n(91," Changer le mot de passe "),e()()()(),m(92,"mat-divider"),t(93,"section",7)(94,"h2")(95,"mat-icon"),n(96,"info"),e(),n(97," Informations du compte "),e(),t(98,"div",24)(99,"div",25)(100,"mat-icon"),n(101,"event"),e(),t(102,"div")(103,"strong"),n(104,"Membre depuis"),e(),t(105,"p"),n(106),e()()(),t(107,"div",25)(108,"mat-icon"),n(109,"update"),e(),t(110,"div")(111,"strong"),n(112,"Derni\xE8re modification"),e(),t(113,"p"),n(114),e()()(),t(115,"div",25)(116,"mat-icon"),n(117,"verified_user"),e(),t(118,"div")(119,"strong"),n(120,"Compte actif"),e(),t(121,"p"),n(122),e()()()()()()()()),a&2){let c,h,x,C,M,S,E,b,P;l(5),F(" ",i.getInitials()," "),l(3),O("",(c=i.currentUser())==null?null:c.first_name," ",((c=i.currentUser())==null?null:c.last_name)||""),l(2),f((h=i.currentUser())==null?null:h.email),l(),p((x=i.currentUser())!=null&&x.role?11:-1),l(8),u("formGroup",i.profileForm),l(20),p((C=i.profileForm.get("email"))!=null&&C.hasError("email")?39:-1),l(12),u("value",i.getRoleLabel(((M=i.currentUser())==null?null:M.role)||"")),l(4),u("disabled",!i.profileForm.valid||!i.profileForm.dirty||i.saving()),l(),p(i.saving()?56:57),l(9),u("formGroup",i.passwordForm),l(14),p((S=i.passwordForm.get("new_password"))!=null&&S.hasError("minlength")?79:-1),l(7),p(i.passwordForm.hasError("passwordMismatch")?86:-1),l(2),u("disabled",!i.passwordForm.valid||i.changingPassword()),l(),p(i.changingPassword()?89:90),l(17),f(i.formatDate((E=i.currentUser())==null?null:E.created_at)),l(8),f(i.formatDate((b=i.currentUser())==null?null:b.updated_at)),l(8),f((P=i.currentUser())!=null&&P.is_active?"Oui":"Non")}},dependencies:[I,q,T,U,k,D,A,B,V,R,z,G,Q,J,j,K,H,$,X,W,Z,Y,te,ee,le,oe,ae,ie,ne],styles:[".profile-container[_ngcontent-%COMP%]{padding:24px;max-width:1200px;margin:0 auto}.profile-card[_ngcontent-%COMP%]{box-shadow:0 4px 6px #0000001a}.profile-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:24px;padding:16px 0}.avatar[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:700;color:#fff}.user-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px}.user-info[_ngcontent-%COMP%]   .email[_ngcontent-%COMP%]{margin:4px 0;color:#666}.role-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:12px;background-color:#e3f2fd;color:#1976d2;font-size:12px;font-weight:500}.section[_ngcontent-%COMP%]{padding:24px 0}.section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:16px;font-size:18px;color:#333}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px;margin-bottom:16px}.actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px;background-color:#f5f5f5;border-radius:8px}.info-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#1976d2}.info-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:4px;color:#333}.info-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px}mat-spinner[_ngcontent-%COMP%]{display:inline-block;margin-right:8px}"],changeDetection:0})}};export{se as ProfileComponent};
