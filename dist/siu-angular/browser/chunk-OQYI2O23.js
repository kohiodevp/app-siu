import{a as B}from"./chunk-IEHSEMB4.js";import{a as L,b as R}from"./chunk-GZTPAS53.js";import{a as j,b as N,g as A}from"./chunk-MR57I2Q4.js";import{a as I,b as U}from"./chunk-3WYC6ROS.js";import{a as E,b as k}from"./chunk-UUJ2B6HP.js";import{$ as T,W as z,Y as S}from"./chunk-AQZ5PN4T.js";import{p as D,z as V}from"./chunk-3AYM6UTQ.js";import{Cb as w,Db as b,Ec as x,Ib as _,Jb as t,Kb as n,Lb as M,Sb as C,Ua as h,Va as v,Wb as d,Xa as m,Yb as l,ba as g,ga as s,ha as p,hc as O,kc as r,lb as P,lc as f,mc as y,sa as u}from"./chunk-E7AQ6X4Y.js";function F(o,a){if(o&1){let e=C();t(0,"button",13),d("click",function(){s(e);let c=l();return p(c.zoomOut())}),t(1,"mat-icon"),r(2,"zoom_out"),n()(),t(3,"span",14),r(4),n(),t(5,"button",15),d("click",function(){s(e);let c=l();return p(c.zoomIn())}),t(6,"mat-icon"),r(7,"zoom_in"),n()(),t(8,"button",16),d("click",function(){s(e);let c=l();return p(c.resetZoom())}),t(9,"mat-icon"),r(10,"fit_screen"),n()(),t(11,"mat-icon",17),r(12,"more_vert"),n()}if(o&2){let e=l();_("disabled",e.zoomLevel()<=50),m(4),y("",e.zoomLevel(),"%"),m(),_("disabled",e.zoomLevel()>=200)}}function W(o,a){if(o&1){let e=C();t(0,"button",18),d("click",function(){s(e);let c=l();return p(c.print())}),t(1,"mat-icon"),r(2,"print"),n()(),t(3,"button",19),d("click",function(){s(e);let c=l();return p(c.download())}),t(4,"mat-icon"),r(5,"download"),n()()}}function $(o,a){o&1&&(t(0,"div",8),M(1,"mat-spinner",20),t(2,"p"),r(3,"Chargement du document..."),n()())}function G(o,a){if(o&1){let e=C();t(0,"div",9)(1,"mat-icon",21),r(2,"error_outline"),n(),t(3,"p"),r(4),n(),t(5,"button",22),d("click",function(){s(e);let c=l();return p(c.onClose())}),r(6," Fermer "),n()()}if(o&2){let e=l();m(4),f(e.error())}}function q(o,a){if(o&1&&M(0,"iframe",10),o&2){let e=l();_("src",e.documentUrl(),v)}}function H(o,a){if(o&1&&(t(0,"div",11),M(1,"img",23),n()),o&2){let e=l();m(),O("transform","scale("+e.zoomLevel()/100+")"),_("src",e.documentUrl(),h)("alt",e.data.filename)}}function J(o,a){if(o&1){let e=C();t(0,"div",12)(1,"mat-icon"),r(2),n(),t(3,"p",24),r(4,"Pr\xE9visualisation non disponible"),n(),t(5,"p",25),r(6," Ce type de fichier ne peut pas \xEAtre affich\xE9 directement dans le navigateur. "),n(),t(7,"button",22),d("click",function(){s(e);let c=l();return p(c.download())}),t(8,"mat-icon"),r(9,"download"),n(),r(10," T\xE9l\xE9charger le fichier "),n()()}if(o&2){let e=l();m(2),f(e.fileIcon())}}var Z=class o{constructor(){this.dialogRef=g(j);this.documentService=g(B);this.sanitizer=g(V);this.data=g(N);this.loading=u(!0);this.error=u(null);this.documentUrl=u(null);this.blobUrl=u(null);this.zoomLevel=u(100);this.isViewable=x(()=>this.isPdf()||this.isImage());this.fileIcon=x(()=>this.isPdf()?"picture_as_pdf":this.isImage()?"image":this.data.mimeType.includes("word")?"description":this.data.mimeType.includes("excel")?"table_chart":"insert_drive_file");this.loadDocument()}loadDocument(){this.loading.set(!0),this.error.set(null),this.documentService.downloadDocument(this.data.documentId).subscribe({next:a=>{let e=window.URL.createObjectURL(a);if(this.blobUrl.set(e),this.isPdf()){let i=this.sanitizer.bypassSecurityTrustResourceUrl(e);this.documentUrl.set(i)}else this.isImage()&&this.documentUrl.set(e);this.loading.set(!1)},error:a=>{this.loading.set(!1),this.error.set("Erreur lors du chargement du document"),console.error("Error loading document:",a)}})}isPdf(){return this.data.mimeType==="application/pdf"}isImage(){return this.data.mimeType.startsWith("image/")}zoomIn(){this.zoomLevel()<200&&this.zoomLevel.set(this.zoomLevel()+10)}zoomOut(){this.zoomLevel()>50&&this.zoomLevel.set(this.zoomLevel()-10)}resetZoom(){this.zoomLevel.set(100)}download(){this.blobUrl()&&this.documentService.triggerDownload(new Blob([this.blobUrl()]),this.data.filename)}print(){if(this.isPdf()&&this.blobUrl()){let a=window.open(this.blobUrl(),"_blank");a?.addEventListener("load",()=>{a.print()})}else if(this.isImage()&&this.blobUrl()){let a=window.open("","_blank");a&&(a.document.write(`
          <html>
            <head>
              <title>Impression - ${this.data.filename}</title>
              <style>
                body { margin: 0; display: flex; justify-content: center; align-items: center; }
                img { max-width: 100%; height: auto; }
              </style>
            </head>
            <body>
              <img src="${this.blobUrl()}" onload="window.print(); window.close();" />
            </body>
          </html>
        `),a.document.close())}}onClose(){this.blobUrl()&&window.URL.revokeObjectURL(this.blobUrl()),this.dialogRef.close()}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=P({type:o,selectors:[["app-document-viewer"]],decls:20,vars:5,consts:[[1,"viewer-container"],["color","primary",1,"viewer-toolbar"],[1,"toolbar-content"],[1,"document-info"],[1,"filename"],[1,"toolbar-actions"],["mat-icon-button","","matTooltip","Fermer",3,"click"],[1,"viewer-content"],[1,"loading-container"],[1,"error-container"],["frameborder","0",1,"pdf-viewer",3,"src"],[1,"image-container"],[1,"unsupported-container"],["mat-icon-button","","matTooltip","Zoom arri\xE8re",3,"click","disabled"],[1,"zoom-level"],["mat-icon-button","","matTooltip","Zoom avant",3,"click","disabled"],["mat-icon-button","","matTooltip","R\xE9initialiser le zoom",3,"click"],[1,"separator"],["mat-icon-button","","matTooltip","Imprimer",3,"click"],["mat-icon-button","","matTooltip","T\xE9l\xE9charger",3,"click"],["diameter","50"],["color","warn"],["mat-raised-button","","color","primary",3,"click"],[1,"image-viewer",3,"src","alt"],[1,"unsupported-title"],[1,"unsupported-subtitle"]],template:function(e,i){e&1&&(t(0,"div",0)(1,"mat-toolbar",1)(2,"div",2)(3,"div",3)(4,"mat-icon"),r(5),n(),t(6,"span",4),r(7),n()(),t(8,"div",5),w(9,F,13,3),w(10,W,6,0),t(11,"button",6),d("click",function(){return i.onClose()}),t(12,"mat-icon"),r(13,"close"),n()()()()(),t(14,"div",7),w(15,$,4,0,"div",8)(16,G,7,1,"div",9)(17,q,1,1,"iframe",10)(18,H,2,4,"div",11)(19,J,11,1,"div",12),n()()),e&2&&(m(5),f(i.fileIcon()),m(2),f(i.data.filename),m(2),b(i.isImage()&&!i.loading()&&!i.error()?9:-1),m(),b(!i.loading()&&!i.error()?10:-1),m(5),b(i.loading()?15:i.error()?16:i.isPdf()?17:i.isImage()?18:19))},dependencies:[D,A,T,S,z,k,E,U,I,R,L],styles:[".viewer-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:#f5f5f5}.viewer-toolbar[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;box-shadow:0 2px 4px #0000001a}.viewer-toolbar[_ngcontent-%COMP%]   .toolbar-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;gap:1rem}.viewer-toolbar[_ngcontent-%COMP%]   .document-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;flex:1;min-width:0}.viewer-toolbar[_ngcontent-%COMP%]   .document-info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.viewer-toolbar[_ngcontent-%COMP%]   .document-info[_ngcontent-%COMP%]   .filename[_ngcontent-%COMP%]{font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.viewer-toolbar[_ngcontent-%COMP%]   .toolbar-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.viewer-toolbar[_ngcontent-%COMP%]   .toolbar-actions[_ngcontent-%COMP%]   .zoom-level[_ngcontent-%COMP%]{padding:0 .5rem;font-size:.9rem;font-weight:500;min-width:50px;text-align:center}.viewer-toolbar[_ngcontent-%COMP%]   .toolbar-actions[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin:0 .5rem;opacity:.3}.viewer-content[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:center;align-items:center;overflow:auto;position:relative}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%], .unsupported-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.5rem;padding:2rem;text-align:center}.loading-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .unsupported-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .unsupported-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1rem;color:#666}.error-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#f44336}.error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#d32f2f;font-weight:500}.unsupported-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#757575;opacity:.5}.unsupported-container[_ngcontent-%COMP%]   .unsupported-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:500;color:#333}.unsupported-container[_ngcontent-%COMP%]   .unsupported-subtitle[_ngcontent-%COMP%]{font-size:.95rem;color:#666;max-width:400px}.unsupported-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:.5rem}.pdf-viewer[_ngcontent-%COMP%]{width:100%;height:100%;border:none}.image-container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;overflow:auto;padding:2rem}.image-container[_ngcontent-%COMP%]   .image-viewer[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain;transition:transform .2s ease;box-shadow:0 4px 12px #00000026;border-radius:4px;background:#fff}@media(max-width:768px){.viewer-toolbar[_ngcontent-%COMP%]   .document-info[_ngcontent-%COMP%]   .filename[_ngcontent-%COMP%]{max-width:150px}.viewer-toolbar[_ngcontent-%COMP%]   .toolbar-actions[_ngcontent-%COMP%]   .zoom-level[_ngcontent-%COMP%]{display:none}.image-container[_ngcontent-%COMP%]{padding:1rem}}@media(max-width:480px){.viewer-toolbar[_ngcontent-%COMP%]   .toolbar-content[_ngcontent-%COMP%]{gap:.25rem}.viewer-toolbar[_ngcontent-%COMP%]   .document-info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.viewer-toolbar[_ngcontent-%COMP%]   .document-info[_ngcontent-%COMP%]   .filename[_ngcontent-%COMP%]{font-size:.9rem;max-width:100px}.viewer-toolbar[_ngcontent-%COMP%]   .toolbar-actions[_ngcontent-%COMP%]{gap:0}.viewer-toolbar[_ngcontent-%COMP%]   .toolbar-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0;width:36px;height:36px}.viewer-toolbar[_ngcontent-%COMP%]   .toolbar-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.viewer-toolbar[_ngcontent-%COMP%]   .toolbar-actions[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{display:none}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%], .unsupported-container[_ngcontent-%COMP%]{padding:1rem}.loading-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .unsupported-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .unsupported-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}}[_nghost-%COMP%]     .mat-mdc-dialog-container{padding:0!important;overflow:hidden}"],changeDetection:0})}};export{Z as a};
