import{a as me,b as le}from"./chunk-BYAQRIZS.js";import{a as ae}from"./chunk-23KMSIXT.js";import{a as se,b as de}from"./chunk-EBJYW3C2.js";import{d as re,h as ne,i as oe}from"./chunk-474YFGF3.js";import"./chunk-CVA3OUYK.js";import{b as J,c as K}from"./chunk-JBX6OC6U.js";import{a as H}from"./chunk-V6MGZ35S.js";import{b as j,c as z,e as Z,i as $}from"./chunk-DEKAXLAX.js";import{a as ee,b as te}from"./chunk-GWNY4E3S.js";import"./chunk-MXRZJWAE.js";import"./chunk-3FMCGYQ4.js";import{a as ie}from"./chunk-PY62MJCA.js";import"./chunk-FJY5KO7T.js";import"./chunk-L64YGAYQ.js";import{a as k,c as A,e as G,h as B}from"./chunk-HFRGPHGK.js";import{b as y,d,g as N,h as q,k as w,m as D,n as T,q as R,s as L,u as V}from"./chunk-M2VBT7VT.js";import{a as X,b as Y}from"./chunk-STMJJCCP.js";import{$ as W,Y as Q}from"./chunk-ZNVG5ZVS.js";import{a as U,c as I}from"./chunk-LMV7XNWS.js";import"./chunk-FBCHPQNP.js";import"./chunk-YGREV7VD.js";import{Cb as l,Db as s,Gb as x,Hb as b,Ib as f,Jb as i,Kb as e,Lb as u,Wb as _,Xa as m,Yb as F,ba as p,kc as r,lb as S,lc as C,mc as O,nc as P,sa as g}from"./chunk-E7AQ6X4Y.js";import"./chunk-EQDQRRRY.js";var ce=(o,t)=>t.value;function pe(o,t){o&1&&(i(0,"mat-error"),r(1,"Le nom d'utilisateur est requis"),e())}function fe(o,t){o&1&&(i(0,"mat-error"),r(1,"Minimum 3 caract\xE8res"),e())}function ge(o,t){o&1&&(i(0,"mat-error"),r(1,"Le nom complet est requis"),e())}function _e(o,t){o&1&&(i(0,"mat-error"),r(1,"L'email est requis"),e())}function Ce(o,t){o&1&&(i(0,"mat-error"),r(1,"Email invalide"),e())}function he(o,t){o&1&&(i(0,"mat-error"),r(1,"Le mot de passe est requis"),e())}function Me(o,t){o&1&&(i(0,"mat-error"),r(1,"Minimum 8 caract\xE8res"),e())}function ve(o,t){if(o&1&&(i(0,"mat-form-field",4)(1,"mat-label"),r(2,"Mot de passe"),e(),u(3,"input",19),i(4,"mat-icon",6),r(5,"lock"),e(),l(6,he,2,0,"mat-error"),l(7,Me,2,0,"mat-error"),e()),o&2){let n,a,c=F();m(6),s((n=c.userForm.get("password"))!=null&&n.hasError("required")?6:-1),m(),s((a=c.userForm.get("password"))!=null&&a.hasError("minlength")?7:-1)}}function Ee(o,t){if(o&1&&(i(0,"mat-option",10),r(1),e()),o&2){let n=t.$implicit;f("value",n.value),m(),P(" ",n.label," - ",n.description," ")}}function Se(o,t){o&1&&u(0,"mat-spinner",18)}var ue=class o{constructor(){this.fb=p(L);this.userService=p(ae);this.router=p(I);this.route=p(U);this.notificationService=p(ie);this.loading=g(!1);this.userId=g(null);this.isEditMode=g(!1);this.roles=Object.entries(me).map(([t,n])=>({value:t,label:n,description:le[t]}));this.userForm=this.fb.group({username:["",[d.required,d.minLength(3)]],email:["",[d.required,d.email]],password:["",[d.required,d.minLength(8)]],full_name:["",d.required],role:["citizen",d.required],phone:[""],department:[""],is_active:[!0]})}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t&&t!=="new"&&(this.userId.set(parseInt(t)),this.isEditMode.set(!0),this.loadUser(parseInt(t)),this.userForm.get("password")?.clearValidators(),this.userForm.get("password")?.updateValueAndValidity())}loadUser(t){this.loading.set(!0),this.userService.getUserById(t).subscribe({next:n=>{this.userForm.patchValue({username:n.username,email:n.email,first_name:n.first_name,role:n.role||"citizen",phone:n.phone,department:n.department,is_active:n.is_active}),this.userForm.get("username")?.disable(),this.loading.set(!1)},error:n=>{console.error("Error loading user:",n),this.notificationService.showError("Erreur lors du chargement de l'utilisateur"),this.loading.set(!1),this.router.navigate(["/users"])}})}onSubmit(){if(this.userForm.invalid){this.notificationService.showError("Veuillez remplir tous les champs requis");return}this.loading.set(!0);let t=this.userForm.getRawValue();if(this.isEditMode()){let n={email:t.email,full_name:t.full_name,role:t.role,phone:t.phone,department:t.department,is_active:t.is_active};this.userService.updateUser(this.userId(),n).subscribe({next:()=>{this.notificationService.showSuccess("Utilisateur modifi\xE9 avec succ\xE8s"),this.router.navigate(["/users"])},error:a=>{console.error("Error updating user:",a),this.notificationService.showError("Erreur lors de la modification"),this.loading.set(!1)}})}else{let n=t;this.userService.createUser(n).subscribe({next:()=>{this.notificationService.showSuccess("Utilisateur cr\xE9\xE9 avec succ\xE8s"),this.router.navigate(["/users"])},error:a=>{console.error("Error creating user:",a),this.notificationService.showError("Erreur lors de la cr\xE9ation"),this.loading.set(!1)}})}}cancel(){this.router.navigate(["/users"])}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-user-form"]],decls:64,vars:13,consts:[[1,"user-form-container"],[1,"page-header"],[3,"ngSubmit","formGroup"],[1,"form-grid"],["appearance","outline"],["matInput","","formControlName","username","required",""],["matPrefix",""],["matInput","","formControlName","full_name","required",""],["matInput","","type","email","formControlName","email","required",""],["formControlName","role","required",""],[3,"value"],["matInput","","type","tel","formControlName","phone"],["matInput","","formControlName","department"],[1,"checkbox-field"],["formControlName","is_active"],["align","end"],["mat-button","","type","button",3,"click","disabled"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["diameter","20"],["matInput","","type","password","formControlName","password","required",""]],template:function(n,a){if(n&1&&(i(0,"div",0)(1,"div",1)(2,"h1")(3,"mat-icon"),r(4),e(),r(5),e()(),i(6,"mat-card")(7,"mat-card-content")(8,"form",2),_("ngSubmit",function(){return a.onSubmit()}),i(9,"div",3)(10,"mat-form-field",4)(11,"mat-label"),r(12,"Nom d'utilisateur"),e(),u(13,"input",5),i(14,"mat-icon",6),r(15,"person"),e(),l(16,pe,2,0,"mat-error"),l(17,fe,2,0,"mat-error"),e(),i(18,"mat-form-field",4)(19,"mat-label"),r(20,"Nom complet"),e(),u(21,"input",7),i(22,"mat-icon",6),r(23,"badge"),e(),l(24,ge,2,0,"mat-error"),e(),i(25,"mat-form-field",4)(26,"mat-label"),r(27,"Email"),e(),u(28,"input",8),i(29,"mat-icon",6),r(30,"email"),e(),l(31,_e,2,0,"mat-error"),l(32,Ce,2,0,"mat-error"),e(),l(33,ve,8,2,"mat-form-field",4),i(34,"mat-form-field",4)(35,"mat-label"),r(36,"R\xF4le"),e(),i(37,"mat-select",9),x(38,Ee,2,3,"mat-option",10,ce),e(),i(40,"mat-icon",6),r(41,"shield"),e()(),i(42,"mat-form-field",4)(43,"mat-label"),r(44,"T\xE9l\xE9phone"),e(),u(45,"input",11),i(46,"mat-icon",6),r(47,"phone"),e()(),i(48,"mat-form-field",4)(49,"mat-label"),r(50,"D\xE9partement"),e(),u(51,"input",12),i(52,"mat-icon",6),r(53,"business"),e()()(),i(54,"div",13)(55,"mat-checkbox",14),r(56," Compte actif "),e()(),i(57,"mat-card-actions",15)(58,"button",16),_("click",function(){return a.cancel()}),r(59," Annuler "),e(),i(60,"button",17),l(61,Se,1,0,"mat-spinner",18),i(62,"span"),r(63),e()()()()()()()),n&2){let c,h,M,v,E;m(4),C(a.isEditMode()?"edit":"person_add"),m(),O(" ",a.isEditMode()?"Modifier l'utilisateur":"Nouvel utilisateur"," "),m(3),f("formGroup",a.userForm),m(8),s((c=a.userForm.get("username"))!=null&&c.hasError("required")?16:-1),m(),s((h=a.userForm.get("username"))!=null&&h.hasError("minlength")?17:-1),m(7),s((M=a.userForm.get("full_name"))!=null&&M.hasError("required")?24:-1),m(7),s((v=a.userForm.get("email"))!=null&&v.hasError("required")?31:-1),m(),s((E=a.userForm.get("email"))!=null&&E.hasError("email")?32:-1),m(),s(a.isEditMode()?-1:33),m(5),b(a.roles),m(20),f("disabled",a.loading()),m(2),f("disabled",a.loading()||a.userForm.invalid),m(),s(a.loading()?61:-1),m(2),C(a.isEditMode()?"Modifier":"Cr\xE9er")}},dependencies:[V,w,y,N,q,R,T,D,B,k,G,A,H,$,j,z,Z,K,J,oe,ne,re,de,se,W,Q,Y,X,te,ee],styles:[".user-form-container[_ngcontent-%COMP%]{padding:24px;max-width:1000px;margin:0 auto}.user-form-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{margin-bottom:24px}.user-form-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:500;margin:0}.user-form-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--mat-primary-color)}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px;margin-bottom:16px}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-field[_ngcontent-%COMP%]{margin-bottom:24px}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]{padding-top:16px;border-top:1px solid var(--mat-divider-color);gap:12px}@media(max-width:768px){.user-form-container[_ngcontent-%COMP%]{padding:16px}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"],changeDetection:0})}};export{ue as UserFormComponent};
