import{a as ce,b as de}from"./chunk-JNBWNSPZ.js";import{a as ue,d as pe,e as ge,f as be,g as fe}from"./chunk-MR57I2Q4.js";import{d as le,h as se,i as me}from"./chunk-M2B5FNU7.js";import{b as Y,c as Z}from"./chunk-E7OICD5F.js";import{a as Q}from"./chunk-OFBHONAA.js";import{b as J,c as H,d as K,i as X}from"./chunk-YPBVTN56.js";import{a as ae}from"./chunk-TAVIRTLO.js";import{a as re}from"./chunk-RSTPHI64.js";import{b as k,d as P,g as A,h as N,k as R,m as j,n as V,q as L,r as G,s as q,u as W}from"./chunk-4TEKNYBZ.js";import{a as ie,b as oe}from"./chunk-UUJ2B6HP.js";import{$ as ne,W as ee,Y as te}from"./chunk-AQZ5PN4T.js";import{a as B}from"./chunk-NYFRATJG.js";import{A as M,p as U}from"./chunk-3AYM6UTQ.js";import{Cb as g,Db as b,Gb as T,Hb as z,Ib as f,Jb as r,Kb as o,Lb as h,Sb as O,Ua as F,Wb as d,Xa as m,Y as w,Yb as u,ba as p,ga as D,gc as E,ha as x,hc as I,ic as $,kc as l,lb as S,lc as y,mc as v,sa as _}from"./chunk-E7AQ6X4Y.js";var C=class a{constructor(){this.api=p(B)}uploadDocument(e,t,n,i=!1,s=[]){let c=new FormData;return c.append("file",t),c.append("document_type",n),c.append("is_public",i.toString()),c.append("tags",JSON.stringify(s)),this.api.upload(`/parcels/${e}/documents`,c)}uploadMultipleDocuments(e,t,n,i=!1){let s=new FormData;return t.forEach(c=>s.append("files",c)),s.append("document_type",n),s.append("is_public",i.toString()),this.api.upload(`/parcels/${e}/documents/multiple`,s)}getParcelDocuments(e,t=1,n=10){return this.api.get(`/parcels/${e}/documents`,{page:t,page_size:n})}getDocument(e){return this.api.get(`/documents/${e}`)}downloadDocument(e){return this.api.download(`/documents/${e}/download`)}downloadDocumentAs(e,t){return this.api.download(`/documents/${e}/download?filename=${encodeURIComponent(t)}`)}deleteDocument(e){return this.api.delete(`/documents/${e}`)}updateDocument(e,t){return this.api.put(`/documents/${e}`,t)}analyzeDocument(e){return this.api.get(`/documents/${e}/analyze`)}extractText(e){return this.api.get(`/documents/${e}/extract-text`)}classifyDocument(e){return this.api.get(`/documents/${e}/classify`)}searchDocuments(e){let t={};return e.parcelId&&(t.parcel_id=e.parcelId),e.documentType&&(t.document_type=e.documentType),e.fileName&&(t.filename=e.fileName),e.uploadedBy&&(t.uploaded_by=e.uploadedBy),e.fromDate&&(t.from_date=e.fromDate),e.toDate&&(t.to_date=e.toDate),e.tags&&(t.tags=e.tags.join(",")),e.page&&(t.page=e.page),e.pageSize&&(t.page_size=e.pageSize),this.api.get("/documents/search",t)}searchInDocuments(e,t,n,i=1,s=10){let c={query:e,page:i,page_size:s};return t&&(c.parcel_id=t),n&&(c.document_type=n),this.api.get("/documents/search-text",c)}generatePreview(e,t=1){return this.api.download(`/documents/${e}/preview?page=${t}`)}generateThumbnail(e,t=200,n=200){return this.api.download(`/documents/${e}/thumbnail?width=${t}&height=${n}`)}convertDocument(e,t){return this.api.download(`/documents/${e}/convert?format=${t}`)}validateDocument(e){return this.api.get(`/documents/${e}/validate`)}signDocument(e,t){return this.api.post(`/documents/${e}/sign`,{signature:t})}verifySignature(e){return this.api.get(`/documents/${e}/verify-signature`)}addAnnotations(e,t){return this.api.post(`/documents/${e}/annotations`,{annotations:t})}getAnnotations(e){return this.api.get(`/documents/${e}/annotations`)}compareDocuments(e,t){return this.api.get(`/documents/${e}/compare/${t}`)}mergeDocuments(e,t="pdf"){return this.api.postBlob("/documents/merge",{document_ids:e,output_format:t})}splitDocument(e,t){return this.api.post(`/documents/${e}/split`,{pages:t})}protectDocument(e,t){return this.api.post(`/documents/${e}/protect`,{password:t})}unprotectDocument(e,t){return this.api.post(`/documents/${e}/unprotect`,{password:t})}getDocumentHistory(e){return this.api.get(`/documents/${e}/history`)}shareDocument(e,t,n="view"){return this.api.post(`/documents/${e}/share`,{recipients:t,permissions:n})}getSharedDocuments(e){let t={};return e&&(t.user_id=e),this.api.get("/documents/shared",t)}searchByTags(e,t=1,n=10){return this.api.get("/documents/search-tags",{tags:e.join(","),page:t,page_size:n})}addTags(e,t){return this.api.post(`/documents/${e}/tags`,{tags:t})}removeTags(e,t){return this.api.delete(`/documents/${e}/tags`,{tags:t.join(",")})}getPopularTags(e=20){return this.api.get("/documents/popular-tags",{limit:e})}generateIndex(e){let t={};return e&&(e.parcelId&&(t.parcel_id=e.parcelId),e.documentType&&(t.document_type=e.documentType),e.fromDate&&(t.from_date=e.fromDate),e.toDate&&(t.to_date=e.toDate)),this.api.get("/documents/generate-index",t)}exportMetadata(e,t){let n={format:e};return t&&(t.parcelId&&(n.parcel_id=t.parcelId),t.documentType&&(n.document_type=t.documentType),t.fromDate&&(n.from_date=t.fromDate),t.toDate&&(n.to_date=t.toDate)),this.api.postBlob("/documents/export-metadata",n)}importDocuments(e,t){let n=new FormData;return e.forEach((i,s)=>{n.append("files",i),t[s]&&n.append(`metadata[${s}]`,JSON.stringify(t[s]))}),this.api.upload("/documents/import",n)}checkCompliance(e){return this.api.get(`/documents/${e}/compliance`)}archiveDocument(e){return this.api.post(`/documents/${e}/archive`,{})}restoreDocument(e){return this.api.post(`/documents/${e}/restore`,{})}getArchivedDocuments(e=1,t=10){return this.api.get("/documents/archived",{page:e,page_size:t})}permanentlyDeleteDocument(e){return this.api.delete(`/documents/${e}/permanent`)}getRecentlyAccessedDocuments(e,t=10){return this.api.get("/documents/recently-accessed",{user_id:e,limit:t})}markAsFavorite(e){return this.api.post(`/documents/${e}/favorite`,{})}removeFromFavorites(e){return this.api.delete(`/documents/${e}/favorite`)}getFavoriteDocuments(e,t=1,n=10){return this.api.get("/documents/favorites",{user_id:e,page:t,page_size:n})}triggerDownload(e,t){let n=window.URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=t,i.click(),window.URL.revokeObjectURL(n)}isImage(e){return e.startsWith("image/")}isPdf(e){return e==="application/pdf"}getDocumentIcon(e){return{title_deed:"description",survey_plan:"map",building_permit:"home",tax_certificate:"receipt",photo:"photo",contract:"assignment",authorization:"verified",technical_document:"engineering",other:"insert_drive_file"}[e]||"description"}formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(2))+" "+n[i]}getMaxFileSize(){return M.upload.maxFileSize*1024*1024}getAllowedMimeTypes(){let e=[];return M.upload.allowedTypes.forEach(t=>{t==="image/*"?e.push("image/jpeg","image/png","image/gif","image/bmp","image/webp","image/tiff"):t==="application/pdf"?e.push("application/pdf"):t==="application/msword"?e.push("application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"):e.push(t)}),e}isValidFileSize(e,t){let n=t||this.getMaxFileSize();return e.size<=n}isValidFileType(e,t){return(t||this.getAllowedMimeTypes()).some(i=>{if(i.endsWith("/*")){let s=i.slice(0,i.indexOf("/*"));return e.type.startsWith(s)}return e.type===i})}getAllDocuments(e=1,t=10){return this.api.get("/documents",{page:e,page_size:t})}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275prov=w({token:a,factory:a.\u0275fac,providedIn:"root"})}};var ve=(a,e)=>e.value;function De(a,e){if(a&1){let t=O();r(0,"div",4)(1,"mat-icon",16),l(2,"cloud_upload"),o(),r(3,"p",17),l(4,"Glissez-d\xE9posez un fichier ici"),o(),r(5,"p",18),l(6,"ou"),o(),r(7,"button",19),d("click",function(){D(t);let i=E(12);return x(i.click())}),r(8,"mat-icon"),l(9,"attach_file"),o(),l(10," Parcourir "),o(),r(11,"input",20,0),d("change",function(i){D(t);let s=u();return x(s.onFileSelected(i))}),o(),r(13,"p",21),l(14," Formats accept\xE9s: PDF, JPEG, PNG, GIF, DOC, DOCX"),h(15,"br"),l(16," Taille maximale: 10 MB "),o()()}}function xe(a,e){if(a&1&&h(0,"img",22),a&2){let t=u(2);f("src",t.previewUrl(),F)}}function ye(a,e){if(a&1&&(r(0,"mat-icon",27),l(1),o()),a&2){let t=u(2);I("font-size",64,"px"),m(),v(" ",t.getFileIcon(t.selectedFile())," ")}}function Ce(a,e){if(a&1){let t=O();r(0,"div",5),g(1,xe,1,1,"img",22)(2,ye,2,3,"mat-icon",23),r(3,"div",24)(4,"strong"),l(5),o(),r(6,"span",25),l(7),o()(),r(8,"button",26),d("click",function(){D(t);let i=u();return x(i.removeFile())}),r(9,"mat-icon"),l(10,"close"),o()()()}if(a&2){let t=u();m(),b(t.previewUrl()?1:2),m(4),y(t.selectedFile().name),m(2),y(t.formatFileSize(t.selectedFile().size))}}function Oe(a,e){if(a&1&&(r(0,"div",6)(1,"mat-icon"),l(2,"error"),o(),l(3),o()),a&2){let t=u();m(3),v(" ",t.error()," ")}}function Me(a,e){if(a&1&&(r(0,"mat-option",9)(1,"mat-icon"),l(2),o(),l(3),o()),a&2){let t=e.$implicit;f("value",t.value),m(2),y(t.icon),m(),v(" ",t.label," ")}}function Pe(a,e){a&1&&(r(0,"mat-error"),l(1,"Le type de document est requis"),o())}function we(a,e){a&1&&(r(0,"div",13),h(1,"mat-progress-bar",28),r(2,"p"),l(3,"Upload en cours..."),o()())}var he=class a{constructor(){this.dialogRef=p(ue);this.documentService=p(C);this.fb=p(q);this.uploading=_(!1);this.selectedFile=_(null);this.previewUrl=_(null);this.error=_(null);this.uploadForm=this.fb.group({documentType:["",P.required],parcelId:[""],description:["",P.maxLength(500)]});this.documentTypes=[{value:"title_deed",label:"Titre de propri\xE9t\xE9",icon:"gavel"},{value:"survey_plan",label:"Plan d'arpentage",icon:"map"},{value:"building_permit",label:"Permis de construire",icon:"construction"},{value:"tax_certificate",label:"Certificat fiscal",icon:"account_balance"},{value:"photo",label:"Photo",icon:"photo"},{value:"other",label:"Autre",icon:"description"}];this.maxFileSize=10*1024*1024;this.allowedTypes=["application/pdf","image/jpeg","image/jpg","image/png","image/gif","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}onFileSelected(e){let t=e.target;if(t.files&&t.files.length>0){let n=t.files[0];this.validateAndSetFile(n)}}onFileDrop(e){if(e.preventDefault(),e.stopPropagation(),e.dataTransfer?.files&&e.dataTransfer.files.length>0){let t=e.dataTransfer.files[0];this.validateAndSetFile(t)}}onDragOver(e){e.preventDefault(),e.stopPropagation()}validateAndSetFile(e){if(this.error.set(null),e.size>this.maxFileSize){this.error.set(`Le fichier est trop volumineux. Taille maximale: ${this.formatFileSize(this.maxFileSize)}`);return}if(!this.allowedTypes.includes(e.type)){this.error.set("Type de fichier non support\xE9. Formats accept\xE9s: PDF, JPEG, PNG, GIF, DOC, DOCX");return}if(this.selectedFile.set(e),e.type.startsWith("image/")){let t=new FileReader;t.onload=n=>{this.previewUrl.set(n.target?.result)},t.readAsDataURL(e)}else this.previewUrl.set(null)}removeFile(){this.selectedFile.set(null),this.previewUrl.set(null),this.error.set(null)}onSubmit(){if(this.uploadForm.invalid||!this.selectedFile())return;this.uploading.set(!0),this.error.set(null);let e=this.selectedFile(),t=this.uploadForm.value.documentType,n=this.uploadForm.value.parcelId;if(!n){this.uploading.set(!1),this.error.set("L'ID de la parcelle est requis");return}this.documentService.uploadDocument(n,e,t,!1,[]).subscribe({next:i=>{this.uploading.set(!1),this.dialogRef.close(i)},error:i=>{this.uploading.set(!1),console.error("Erreur lors de l'upload:",i),this.error.set(i.error?.detail||"Erreur lors de l'upload du document")}})}onCancel(){this.dialogRef.close()}formatFileSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(2)+" KB":(e/(1024*1024)).toFixed(2)+" MB"}getFileIcon(e){return e.type.startsWith("image/")?"image":e.type==="application/pdf"?"picture_as_pdf":e.type.includes("word")?"description":"insert_drive_file"}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275cmp=S({type:a,selectors:[["app-document-upload-dialog"]],decls:37,vars:12,consts:[["fileInput",""],["mat-dialog-title",""],[1,"upload-form",3,"formGroup"],[1,"upload-area",3,"drop","dragover"],[1,"upload-placeholder"],[1,"file-preview"],[1,"error-message"],["appearance","outline",1,"full-width"],["formControlName","documentType","required",""],[3,"value"],["matInput","","type","text","formControlName","parcelId","placeholder","Ex: 123"],["matInput","","formControlName","description","rows","3","maxlength","500","placeholder","Ajoutez une description du document..."],["align","end"],[1,"upload-progress"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"],[1,"upload-icon"],[1,"upload-text"],[1,"upload-subtext"],["mat-raised-button","","color","primary","type","button",3,"click"],["type","file","hidden","","accept",".pdf,.jpg,.jpeg,.png,.gif,.doc,.docx",3,"change"],[1,"upload-info"],["alt","Aper\xE7u",1,"preview-image",3,"src"],[1,"file-icon",3,"font-size"],[1,"file-info"],[1,"file-size"],["mat-icon-button","","color","warn","type","button","matTooltip","Supprimer",3,"click"],[1,"file-icon"],["mode","indeterminate","color","primary"]],template:function(t,n){if(t&1&&(r(0,"h2",1)(1,"mat-icon"),l(2,"cloud_upload"),o(),l(3,` Ajouter un document
`),o(),r(4,"mat-dialog-content")(5,"form",2)(6,"div",3),d("drop",function(s){return n.onFileDrop(s)})("dragover",function(s){return n.onDragOver(s)}),g(7,De,17,0,"div",4)(8,Ce,11,3,"div",5),g(9,Oe,4,1,"div",6),o(),r(10,"mat-form-field",7)(11,"mat-label"),l(12,"Type de document"),o(),r(13,"mat-select",8),T(14,Me,4,3,"mat-option",9,ve),o(),g(16,Pe,2,0,"mat-error"),o(),r(17,"mat-form-field",7)(18,"mat-label"),l(19,"ID de la parcelle (optionnel)"),o(),h(20,"input",10),r(21,"mat-hint"),l(22,"Laissez vide si le document n'est pas li\xE9 \xE0 une parcelle"),o()(),r(23,"mat-form-field",7)(24,"mat-label"),l(25,"Description (optionnelle)"),o(),h(26,"textarea",11),r(27,"mat-hint",12),l(28),o()(),g(29,we,4,0,"div",13),o()(),r(30,"mat-dialog-actions",12)(31,"button",14),d("click",function(){return n.onCancel()}),l(32," Annuler "),o(),r(33,"button",15),d("click",function(){return n.onSubmit()}),r(34,"mat-icon"),l(35,"cloud_upload"),o(),l(36," Envoyer "),o()()),t&2){let i,s;m(5),f("formGroup",n.uploadForm),m(),$("has-file",n.selectedFile())("has-error",n.error()),m(),b(n.selectedFile()?8:7),m(2),b(n.error()?9:-1),m(5),z(n.documentTypes),m(2),b((i=n.uploadForm.get("documentType"))!=null&&i.hasError("required")&&((i=n.uploadForm.get("documentType"))!=null&&i.touched)?16:-1),m(12),v(" ",((s=n.uploadForm.get("description"))==null||s.value==null?null:s.value.length)||0," / 500 "),m(),b(n.uploading()?29:-1),m(2),f("disabled",n.uploading()),m(2),f("disabled",!n.selectedFile()||n.uploadForm.invalid||n.uploading())}},dependencies:[U,W,R,k,A,N,L,G,V,j,fe,pe,be,ge,ne,te,ee,oe,ie,Q,X,J,K,H,Z,Y,me,se,le,de,ce,ae,re],styles:["h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin:0;color:#1976d2}h2[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.75rem;width:1.75rem;height:1.75rem}mat-dialog-content[_ngcontent-%COMP%]{min-width:500px;max-width:600px;padding:1.5rem 0}.upload-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.upload-area[_ngcontent-%COMP%]{border:2px dashed rgba(0,0,0,.26);border-radius:12px;padding:2rem;text-align:center;transition:all .3s ease;background:#00000005}.upload-area.has-file[_ngcontent-%COMP%]{border-color:#4caf50;background:#4caf500d}.upload-area.has-error[_ngcontent-%COMP%]{border-color:#f44336;background:#f443360d}.upload-area[_ngcontent-%COMP%]:hover{border-color:#1976d2;background:#1976d20d}.upload-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem}.upload-placeholder[_ngcontent-%COMP%]   .upload-icon[_ngcontent-%COMP%]{font-size:4rem;width:4rem;height:4rem;color:#00000061}.upload-placeholder[_ngcontent-%COMP%]   .upload-text[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;font-weight:500;color:#000000de}.upload-placeholder[_ngcontent-%COMP%]   .upload-subtext[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:#0009}.upload-placeholder[_ngcontent-%COMP%]   .upload-info[_ngcontent-%COMP%]{margin:.5rem 0 0;font-size:.8125rem;color:#00000080;line-height:1.5}.file-preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem}.file-preview[_ngcontent-%COMP%]   .preview-image[_ngcontent-%COMP%]{max-width:200px;max-height:200px;border-radius:8px;box-shadow:0 2px 8px #00000026}.file-preview[_ngcontent-%COMP%]   .file-icon[_ngcontent-%COMP%]{color:#1976d2;font-size:64px;width:64px;height:64px}.file-preview[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.25rem}.file-preview[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1rem;color:#000000de}.file-preview[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]   .file-size[_ngcontent-%COMP%]{font-size:.875rem;color:#0009}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;margin-top:1rem;padding:.75rem;background:#ffebee;border-radius:8px;color:#c62828;font-size:.875rem}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.25rem;width:1.25rem;height:1.25rem}.full-width[_ngcontent-%COMP%]{width:100%}.upload-progress[_ngcontent-%COMP%]{text-align:center}.upload-progress[_ngcontent-%COMP%]   mat-progress-bar[_ngcontent-%COMP%]{margin-bottom:.5rem}.upload-progress[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:#0009}mat-dialog-actions[_ngcontent-%COMP%]{padding:1rem 1.5rem;gap:.75rem}@media(max-width:600px){mat-dialog-content[_ngcontent-%COMP%]{min-width:auto;width:100%}.upload-area[_ngcontent-%COMP%]{padding:1.5rem}}"]})}};export{C as a,he as b};
