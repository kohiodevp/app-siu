import{a as pe}from"./chunk-OQYI2O23.js";import{a as ue,b as ge}from"./chunk-IEHSEMB4.js";import"./chunk-JNBWNSPZ.js";import"./chunk-GZTPAS53.js";import{a as me,b as de}from"./chunk-TUX7OWEK.js";import{c as le,g as se}from"./chunk-MR57I2Q4.js";import{a as ce}from"./chunk-U4ARKFAA.js";import{d as ie,h as re,i as ae}from"./chunk-M2B5FNU7.js";import{b as K,c as Y}from"./chunk-E7OICD5F.js";import{a as G}from"./chunk-OFBHONAA.js";import{b as $,e as j,i as H}from"./chunk-YPBVTN56.js";import"./chunk-3WYC6ROS.js";import"./chunk-AC4QEAXS.js";import"./chunk-QLHDTFGW.js";import{a as oe}from"./chunk-TAVIRTLO.js";import{a as ne}from"./chunk-RSTPHI64.js";import{a as ee,b as te}from"./chunk-XMY2MG46.js";import"./chunk-QDNYLZKO.js";import{a as B,b as V,c as N,d as W,e as U,f as A,h as R}from"./chunk-FY6NZ6SC.js";import{b as F,g as k,j as I,t as z}from"./chunk-4TEKNYBZ.js";import{a as X,b as Z}from"./chunk-UUJ2B6HP.js";import{$ as Q,W as q,Y as J}from"./chunk-AQZ5PN4T.js";import"./chunk-NYFRATJG.js";import{p as L}from"./chunk-3AYM6UTQ.js";import{Cb as f,Db as M,Gb as P,Hb as x,Ib as D,Jb as i,Kb as o,Lb as S,Sb as h,Wb as s,Xa as c,Yb as l,ba as _,ga as p,ha as g,hc as w,kc as r,lb as b,lc as u,mc as T,oc as O,pc as v,qc as y,sa as C,tc as E}from"./chunk-E7AQ6X4Y.js";import"./chunk-EQDQRRRY.js";var Ce=()=>[10,25,50,100],fe=(a,e)=>e.value,Me=(a,e)=>e.id;function he(a,e){if(a&1&&(i(0,"mat-option",7),r(1),o()),a&2){let t=e.$implicit;D("value",t.value),c(),u(t.label)}}function Pe(a,e){a&1&&S(0,"app-loading-spinner",10)}function xe(a,e){if(a&1&&(i(0,"div",19)(1,"mat-icon"),r(2,"description"),o(),i(3,"span"),r(4),o()()),a&2){let t=l().$implicit,n=l(3);c(4),u(n.getDocumentDescription(t))}}function De(a,e){if(a&1){let t=h();i(0,"mat-card",13)(1,"mat-card-header")(2,"div",15)(3,"mat-icon",16),r(4),o()(),i(5,"mat-card-title"),r(6),o(),i(7,"mat-card-subtitle"),r(8),o()(),i(9,"mat-card-content")(10,"div",17)(11,"div",18)(12,"mat-icon"),r(13,"calendar_today"),o(),i(14,"span"),r(15),o()(),i(16,"div",18)(17,"mat-icon"),r(18,"storage"),o(),i(19,"span"),r(20),o()(),f(21,xe,5,1,"div",19),o()(),i(22,"mat-card-actions")(23,"button",20),s("click",function(){let m=p(t).$implicit,d=l(3);return g(d.downloadDocument(m.id,m.filename))}),i(24,"mat-icon"),r(25,"download"),o(),r(26," T\xE9l\xE9charger "),o(),i(27,"button",21),s("click",function(){let m=p(t).$implicit,d=l(3);return g(d.viewDocument(m))}),i(28,"mat-icon"),r(29,"visibility"),o(),r(30," Voir "),o(),i(31,"button",22),s("click",function(){let m=p(t).$implicit,d=l(3);return g(d.deleteDocument(m))}),i(32,"mat-icon"),r(33,"delete"),o()()()()}if(a&2){let t=e.$implicit,n=l(3);c(3),w("color",n.getDocumentTypeColor(t.document_type)),c(),T(" ",n.getDocumentIcon(t.document_type)," "),c(2),u(t.filename),c(2),u(n.getDocumentTypeLabel(t.document_type)),c(7),u(n.formatDate(t.uploaded_at)),c(5),u(n.formatFileSize(t.file_size)),c(),M(n.getDocumentDescription(t)?21:-1)}}function Oe(a,e){if(a&1){let t=h();i(0,"div",12),P(1,De,34,8,"mat-card",13,Me),o(),i(3,"mat-paginator",14),s("page",function(m){p(t);let d=l(2);return g(d.onPageChange(m))}),o()}if(a&2){let t=l(2);c(),x(t.filteredDocuments()),c(2),D("length",t.filteredDocuments().length)("pageSize",t.pageSize)("pageSizeOptions",E(3,Ce))}}function ve(a,e){if(a&1){let t=h();i(0,"div",11)(1,"mat-icon"),r(2,"folder_open"),o(),i(3,"p"),r(4,"Aucun document trouv\xE9"),o(),i(5,"button",2),s("click",function(){p(t);let m=l(2);return g(m.openUploadDialog())}),i(6,"mat-icon"),r(7,"upload"),o(),r(8," Uploader un document "),o()()}}function ye(a,e){if(a&1&&f(0,Oe,4,4)(1,ve,9,0,"div",11),a&2){let t=l();M(t.filteredDocuments().length>0?0:1)}}var _e=class a{constructor(){this.documentService=_(ue);this.dialog=_(le);this.snackBar=_(ee);this.loading=C(!0);this.documents=C([]);this.filteredDocuments=C([]);this.selectedDocumentType="";this.searchTerm="";this.pageSize=25;this.documentTypes=[{value:"title_deed",label:"Titre de propri\xE9t\xE9",icon:"gavel",color:"#1976d2"},{value:"survey_plan",label:"Plan d'arpentage",icon:"map",color:"#388e3c"},{value:"building_permit",label:"Permis de construire",icon:"construction",color:"#f57c00"},{value:"tax_certificate",label:"Certificat fiscal",icon:"account_balance",color:"#7b1fa2"},{value:"photo",label:"Photo",icon:"photo",color:"#0097a7"},{value:"other",label:"Autre",icon:"description",color:"#616161"}]}ngOnInit(){this.loadDocuments()}loadDocuments(){this.documentService.getAllDocuments(1,100).subscribe({next:e=>{this.documents.set(e.items),this.filteredDocuments.set(e.items),this.loading.set(!1)},error:e=>{console.error("Erreur lors du chargement des documents:",e),this.loading.set(!1),this.snackBar.open("Erreur lors du chargement des documents","Fermer",{duration:3e3})}})}applyFilters(){let e=this.documents();if(this.selectedDocumentType&&(e=e.filter(t=>t.document_type===this.selectedDocumentType)),this.searchTerm){let t=this.searchTerm.toLowerCase();e=e.filter(n=>n.filename.toLowerCase().includes(t)||this.hasDescription(n)&&n.description.toLowerCase().includes(t))}this.filteredDocuments.set(e)}hasDescription(e){return"description"in e&&e.description!==void 0}getDocumentDescription(e){if(this.hasDescription(e))return e.description}openUploadDialog(){this.dialog.open(ge,{width:"600px",maxWidth:"90vw",disableClose:!1,autoFocus:!0}).afterClosed().subscribe(t=>{t&&(this.snackBar.open("Document upload\xE9 avec succ\xE8s !","Fermer",{duration:3e3}),this.loadDocuments())})}downloadDocument(e,t){this.documentService.downloadDocument(e).subscribe({next:n=>{this.documentService.triggerDownload(n,t),this.snackBar.open("T\xE9l\xE9chargement en cours...","Fermer",{duration:2e3})},error:n=>{console.error("Erreur lors du t\xE9l\xE9chargement:",n),this.snackBar.open("Erreur lors du t\xE9l\xE9chargement","Fermer",{duration:3e3})}})}viewDocument(e){let t=this.dialog.open(pe,{width:"90vw",height:"90vh",maxWidth:"1400px",maxHeight:"900px",data:{documentId:e.id,filename:e.filename,mimeType:e.mime_type},panelClass:"document-viewer-dialog"})}deleteDocument(e){confirm(`\xCAtes-vous s\xFBr de vouloir supprimer le document "${e.filename}" ?`)&&this.documentService.deleteDocument(e.id).subscribe({next:()=>{this.snackBar.open("Document supprim\xE9 avec succ\xE8s","Fermer",{duration:3e3}),this.loadDocuments()},error:t=>{console.error("Erreur lors de la suppression:",t),this.snackBar.open("Erreur lors de la suppression","Fermer",{duration:3e3})}})}onPageChange(e){this.pageSize=e.pageSize}getDocumentIcon(e){let t=this.documentTypes.find(n=>n.value===e);return t?t.icon:"description"}getDocumentTypeColor(e){let t=this.documentTypes.find(n=>n.value===e);return t?t.color:"#616161"}getDocumentTypeLabel(e){let t=this.documentTypes.find(n=>n.value===e);return t?t.label:e}formatDate(e){return new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})}formatFileSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(2)+" KB":(e/(1024*1024)).toFixed(2)+" MB"}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275cmp=b({type:a,selectors:[["app-document-list"]],decls:25,vars:3,consts:[[1,"documents-container"],[1,"header"],["mat-raised-button","","color","primary",3,"click"],[1,"filters-card"],["appearance","outline"],[3,"valueChange","selectionChange","value"],["value",""],[3,"value"],["matInput","","placeholder","Nom du fichier",3,"ngModelChange","input","ngModel"],["matPrefix",""],["message","Chargement des documents..."],[1,"empty-state"],[1,"documents-grid"],[1,"document-card"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions"],[1,"doc-icon-wrapper"],[1,"doc-icon"],[1,"doc-info"],[1,"info-item"],[1,"info-item","description"],["mat-button","","color","primary",3,"click"],["mat-button","","color","accent",3,"click"],["mat-icon-button","","color","warn","matTooltip","Supprimer",3,"click"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),r(3,"Gestion des documents"),o(),i(4,"button",2),s("click",function(){return n.openUploadDialog()}),i(5,"mat-icon"),r(6,"upload"),o(),r(7," Uploader un document "),o()(),i(8,"mat-card",3)(9,"mat-form-field",4)(10,"mat-label"),r(11,"Type de document"),o(),i(12,"mat-select",5),y("valueChange",function(d){return v(n.selectedDocumentType,d)||(n.selectedDocumentType=d),d}),s("selectionChange",function(){return n.applyFilters()}),i(13,"mat-option",6),r(14,"Tous"),o(),P(15,he,2,2,"mat-option",7,fe),o()(),i(17,"mat-form-field",4)(18,"mat-label"),r(19,"Rechercher par nom"),o(),i(20,"input",8),y("ngModelChange",function(d){return v(n.searchTerm,d)||(n.searchTerm=d),d}),s("input",function(){return n.applyFilters()}),o(),i(21,"mat-icon",9),r(22,"search"),o()()(),f(23,Pe,1,0,"app-loading-spinner",10)(24,ye,2,1),o()),t&2&&(c(12),O("value",n.selectedDocumentType),c(3),x(n.documentTypes),c(5),O("ngModel",n.searchTerm),c(3),M(n.loading()?23:24))},dependencies:[L,z,F,k,I,R,B,U,N,A,W,V,Q,J,q,Z,X,G,H,$,j,Y,K,ae,re,ie,oe,ne,de,me,se,te,ce],styles:[".documents-container[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:2rem}.documents-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.documents-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;font-weight:500}.documents-container[_ngcontent-%COMP%]   .filters-card[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1.5rem;margin-bottom:2rem}.documents-container[_ngcontent-%COMP%]   .filters-card[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1;min-width:200px}.documents-container[_ngcontent-%COMP%]   .documents-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem;margin-bottom:2rem}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;transition:transform .2s,box-shadow .2s}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 4px 12px #00000026}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid rgba(0,0,0,.12)}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   .doc-icon-wrapper[_ngcontent-%COMP%]{margin-right:1rem}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   .doc-icon-wrapper[_ngcontent-%COMP%]   .doc-icon[_ngcontent-%COMP%]{font-size:2.5rem;width:2.5rem;height:2.5rem}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;margin-bottom:.25rem;word-break:break-word}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{font-size:.875rem;color:#0009}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:1rem;flex:1}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .doc-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .doc-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .doc-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.125rem;width:1.125rem;height:1.125rem;color:#0000008a}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .doc-info[_ngcontent-%COMP%]   .info-item.description[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#000000b3;font-style:italic}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem 1rem;border-top:1px solid rgba(0,0,0,.12)}.documents-container[_ngcontent-%COMP%]   .document-card[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{margin-left:auto}.documents-container[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem}.documents-container[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:4rem;width:4rem;height:4rem;color:#00000042;margin-bottom:1rem}.documents-container[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.125rem;color:#0009;margin-bottom:2rem}.documents-container[_ngcontent-%COMP%]   mat-paginator[_ngcontent-%COMP%]{margin-top:2rem}@media(max-width:768px){.documents-container[_ngcontent-%COMP%]{padding:1rem}.documents-container[_ngcontent-%COMP%]   .filters-card[_ngcontent-%COMP%]{flex-direction:column}.documents-container[_ngcontent-%COMP%]   .documents-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}};export{_e as DocumentListComponent};
