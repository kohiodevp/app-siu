import{A as g,u as n,v as u}from"./chunk-YGREV7VD.js";import{B as p,U as c,Y as l,ba as f,l as s,p as b}from"./chunk-E7AQ6X4Y.js";var h=class o{constructor(){this.cache=new Map}set(e,t,r=3e5){let a=Date.now();this.cache.set(e,{data:t,timestamp:a,ttl:r})}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}cleanup(){let e=Date.now();for(let[t,r]of this.cache.entries())e-r.timestamp>r.ttl&&this.cache.delete(t)}has(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),!1):!0:!1}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})}};var d=class o{constructor(){this.http=f(u);this.cache=f(h);this.apiUrl=`${g.apiUrl}/map`;this.CACHE_TTL=300*1e3;this.CACHE_PREFIX="map_"}getParcelsGeoJson(e={}){let t=this.createCacheKey(e),r=this.cache.get(t);if(r)return s(r);let a=new n;return e.bbox&&(a=a.set("bbox",e.bbox)),e.detail&&(a=a.set("detail",e.detail)),e.category&&(a=a.set("category",e.category)),e.status&&(a=a.set("status",e.status)),e.zone&&(a=a.set("zone",e.zone)),e.reference&&(a=a.set("reference",e.reference)),e.minArea&&(a=a.set("min_area",e.minArea.toString())),e.maxArea&&(a=a.set("max_area",e.maxArea.toString())),e.limit&&(a=a.set("limit",e.limit.toString())),e.offset&&(a=a.set("offset",e.offset.toString())),this.http.get(`${this.apiUrl}/parcels/geojson`,{params:a}).pipe(c(i=>{this.cache.set(t,i,this.CACHE_TTL)}),p(i=>(console.error("Error fetching parcels GeoJSON:",i),s({type:"FeatureCollection",features:[],totalCount:0,bbox:[]}))))}getParcelGeoJson(e){let t=`${this.CACHE_PREFIX}parcel_${e}`,r=this.cache.get(t);return r?s(r):this.http.get(`${this.apiUrl}/parcels/${e}/geojson`).pipe(c(a=>{this.cache.set(t,a,this.CACHE_TTL)}))}getMapStatistics(e){let t=new n;return e&&(t=t.set("bbox",e)),this.http.get(`${this.apiUrl}/statistics`,{params:t}).pipe(b(r=>({totalParcels:r.total||0,availableParcels:r.available||0,occupiedParcels:r.occupied||0,disputedParcels:r.disputed||0,reservedParcels:r.reserved||0,totalArea:r.total_area||0,averageArea:r.average_area||0})))}getZonesGeoJson(){let e=`${this.CACHE_PREFIX}zones`,t=this.cache.get(e);return t?s(t):this.http.get(`${this.apiUrl}/zones/geojson`).pipe(c(r=>{this.cache.set(e,r,this.CACHE_TTL*2)}))}geocodeAddress(e){let t=new n().set("q",e);return this.http.get(`${this.apiUrl}/geocode`,{params:t}).pipe(b(r=>r.map(a=>({name:a.display_name,lat:parseFloat(a.lat),lng:parseFloat(a.lon),bbox:a.boundingbox}))))}searchNearby(e,t,r=1e3,a){let i=new n().set("lat",e.toString()).set("lng",t.toString()).set("radius",r.toString());return a?.category&&(i=i.set("category",a.category)),a?.status&&(i=i.set("status",a.status)),this.http.get(`${this.apiUrl}/parcels/nearby`,{params:i})}getHeatmapData(e={}){let t=new n;return e.bbox&&(t=t.set("bbox",e.bbox)),e.status&&(t=t.set("status",e.status)),this.http.get(`${this.apiUrl}/heatmap`,{params:t})}exportMap(e,t){let r=new n().set("format",e);return t&&(r=r.set("bbox",t)),this.http.get(`${this.apiUrl}/export`,{params:r,responseType:"blob"})}createCacheKey(e){let t=[this.CACHE_PREFIX,"parcels"];return e.bbox&&t.push(`bbox_${e.bbox}`),e.detail&&t.push(`detail_${e.detail}`),e.category&&t.push(`cat_${e.category}`),e.status&&t.push(`status_${e.status}`),e.zone&&t.push(`zone_${e.zone}`),e.minArea&&t.push(`min_${e.minArea}`),e.maxArea&&t.push(`max_${e.maxArea}`),t.join("_")}invalidateCache(e){this.cache.clear()}clearAllCache(){this.cache.clear()}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})}};export{d as a};
