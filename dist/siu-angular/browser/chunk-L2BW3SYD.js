import{a as at,b as ot,c as rt,d as lt,e as ct,f as st}from"./chunk-QM7RLUKA.js";import{a as it}from"./chunk-VUQ35JGS.js";import{a as X,b as Y}from"./chunk-5MZAGVAN.js";import{b as et,f as nt}from"./chunk-TC4NHXKF.js";import"./chunk-YPBVTN56.js";import{a as Q,b as W}from"./chunk-3WYC6ROS.js";import"./chunk-QLHDTFGW.js";import{a as tt}from"./chunk-TAVIRTLO.js";import{a as Z}from"./chunk-RSTPHI64.js";import"./chunk-QDNYLZKO.js";import{a as H,b as j,c as L,f as N,h as R}from"./chunk-FY6NZ6SC.js";import"./chunk-4TEKNYBZ.js";import{a as G,b as K}from"./chunk-UUJ2B6HP.js";import{$ as J,W as V,Y as q}from"./chunk-AQZ5PN4T.js";import{d as $}from"./chunk-JWWLDGKM.js";import"./chunk-NYFRATJG.js";import{k as B,l as F,p as U}from"./chunk-3AYM6UTQ.js";import{Cb as g,Db as _,Gb as k,Hb as b,Ib as x,Jb as i,Kb as e,Lb as S,Sb as A,Wb as M,Xa as l,Yb as s,ba as w,ga as y,ha as v,ic as T,kc as n,lb as E,lc as d,mc as C,sa as m,uc as I,wc as P,xc as D,yc as z}from"./chunk-E7AQ6X4Y.js";import{a as O,b as h}from"./chunk-EQDQRRRY.js";var pt=o=>["/parcels",o],mt=(o,a)=>a.id;function gt(o,a){o&1&&(i(0,"div",5),S(1,"mat-spinner",8),i(2,"p"),n(3,"Chargement des alertes..."),e()())}function _t(o,a){if(o&1&&(i(0,"div",6)(1,"mat-icon"),n(2,"check_circle"),e(),i(3,"h3"),n(4,"Aucune alerte"),e(),i(5,"p"),n(6),e()()),o&2){let t=s();l(6),d(t.showOnlyUnacknowledged()?"Toutes les alertes ont \xE9t\xE9 trait\xE9es":"Aucune alerte enregistr\xE9e")}}function xt(o,a){o&1&&(i(0,"mat-chip",13)(1,"mat-icon"),n(2,"check"),e(),n(3," Trait\xE9 "),e())}function Ct(o,a){if(o&1&&(i(0,"div",18)(1,"h4"),n(2,"D\xE9tails suppl\xE9mentaires"),e(),i(3,"pre"),n(4),P(5,"json"),e()()),o&2){let t=s().$implicit;l(4),d(D(5,1,t.details))}}function Mt(o,a){if(o&1){let t=A();i(0,"div",19)(1,"button",20),M("click",function(){y(t);let c=s().$implicit,p=s(2);return v(p.acknowledgeAlert(c))}),i(2,"mat-icon"),n(3,"check"),e(),n(4," Marquer comme trait\xE9 "),e(),i(5,"button",21)(6,"mat-icon"),n(7,"open_in_new"),e(),n(8," Voir la parcelle "),e()()}if(o&2){let t=s().$implicit;l(5),x("routerLink",I(1,pt,t.parcel_id))}}function ut(o,a){if(o&1&&(i(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon",10),n(4),e(),i(5,"span",11),n(6),e()(),i(7,"mat-panel-description")(8,"span",12),n(9),e(),g(10,xt,4,0,"mat-chip",13),e()(),i(11,"div",14)(12,"p",15),n(13),e(),i(14,"div",16)(15,"div",17)(16,"mat-icon"),n(17,"place"),e(),i(18,"span")(19,"strong"),n(20,"Parcelle:"),e(),n(21),e()(),i(22,"div",17)(23,"mat-icon"),n(24,"warning"),e(),i(25,"span")(26,"strong"),n(27,"S\xE9v\xE9rit\xE9:"),e(),n(28),e()(),i(29,"div",17)(30,"mat-icon"),n(31,"schedule"),e(),i(32,"span")(33,"strong"),n(34,"Date:"),e(),n(35),P(36,"date"),e()()(),g(37,Ct,6,3,"div",18),g(38,Mt,9,3,"div",19),e()()),o&2){let t=a.$implicit,r=s(2);T("unacknowledged",!t.acknowledged),l(3),x("color",r.getSeverityColor(t.severity)),l(),C(" ",r.getSeverityIcon(t.severity)," "),l(2),d(r.getAlertTypeLabel(t.type)),l(3),d(r.formatDate(t.created_at)),l(),_(t.acknowledged?10:-1),l(3),d(t.message),l(8),C(" ",t.parcel_reference),l(7),C(" ",t.severity),l(7),C(" ",z(36,13,t.created_at,"dd/MM/yyyy HH:mm")),l(2),_(t.details?37:-1),l(),_(t.acknowledged?-1:38)}}function ft(o,a){if(o&1&&(i(0,"mat-accordion",7),k(1,ut,39,16,"mat-expansion-panel",9,mt),e()),o&2){let t=s();l(),b(t.alerts())}}var dt=class o{constructor(){this.parcelService=w(it);this.loading=m(!0);this.alerts=m([]);this.unacknowledgedCount=m(0);this.showOnlyUnacknowledged=m(!0)}ngOnInit(){this.loadAlerts(),setInterval(()=>this.loadAlerts(),3e4)}loadAlerts(){this.loading.set(!0);let a=this.showOnlyUnacknowledged()?!1:null;this.parcelService.getAlerts(50,a).subscribe({next:t=>{this.alerts.set(t.alerts),this.unacknowledgedCount.set(t.alerts.filter(r=>!r.acknowledged).length),this.loading.set(!1)},error:t=>{console.error("Error loading alerts:",t),this.loading.set(!1)}})}acknowledgeAlert(a){this.parcelService.acknowledgeAlert(a.id).subscribe({next:()=>{let r=this.alerts().map(c=>c.id===a.id?h(O({},c),{acknowledged:!0}):c);this.alerts.set(r),this.unacknowledgedCount.set(r.filter(c=>!c.acknowledged).length)},error:t=>{console.error("Error acknowledging alert:",t),window.alert("Erreur lors de l'accus\xE9 de r\xE9ception")}})}toggleFilter(){this.showOnlyUnacknowledged.set(!this.showOnlyUnacknowledged()),this.loadAlerts()}getSeverityColor(a){return{critical:"warn",high:"warn",medium:"accent",low:"primary"}[a]||"primary"}getSeverityIcon(a){return{critical:"error",high:"warning",medium:"info",low:"notifications"}[a]||"notifications"}getAlertTypeLabel(a){return{double_attribution:"Double attribution",unauthorized_access:"Acc\xE8s non autoris\xE9",data_inconsistency:"Incoh\xE9rence de donn\xE9es",suspicious_activity:"Activit\xE9 suspecte"}[a]||a}formatDate(a){let t=new Date(a),c=new Date().getTime()-t.getTime(),p=Math.floor(c/6e4),u=Math.floor(p/60),f=Math.floor(u/24);return p<1?"\xC0 l'instant":p<60?`Il y a ${p} min`:u<24?`Il y a ${u}h`:f===1?"Hier":f<7?`Il y a ${f} jours`:t.toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric"})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=E({type:o,selectors:[["app-alerts-panel"]],decls:17,vars:5,consts:[[1,"alerts-panel"],["matBadgeColor","warn",3,"matBadge","matBadgeHidden"],[1,"header-actions"],["mat-icon-button","","matTooltip","Actualiser",3,"click"],["mat-icon-button","",3,"click","matTooltip"],[1,"loading-container"],[1,"empty-state"],[1,"alerts-list"],["diameter","40"],[3,"unacknowledged"],[1,"severity-icon",3,"color"],[1,"alert-title"],[1,"alert-time"],[1,"acknowledged-chip"],[1,"alert-details"],[1,"alert-message"],[1,"alert-info"],[1,"info-item"],[1,"alert-extra-details"],[1,"alert-actions"],["mat-raised-button","","color","primary",3,"click"],["mat-stroked-button","",3,"routerLink"]],template:function(t,r){t&1&&(i(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title")(3,"mat-icon",1),n(4," notifications_active "),e(),n(5," Alertes de s\xE9curit\xE9 "),e(),i(6,"div",2)(7,"button",3),M("click",function(){return r.loadAlerts()}),i(8,"mat-icon"),n(9,"refresh"),e()(),i(10,"button",4),M("click",function(){return r.toggleFilter()}),i(11,"mat-icon"),n(12),e()()()(),i(13,"mat-card-content"),g(14,gt,4,0,"div",5)(15,_t,7,1,"div",6)(16,ft,3,0,"mat-accordion",7),e()()),t&2&&(l(3),x("matBadge",r.unacknowledgedCount())("matBadgeHidden",r.unacknowledgedCount()===0),l(7),x("matTooltip",r.showOnlyUnacknowledged()?"Afficher toutes":"Afficher non trait\xE9es"),l(2),d(r.showOnlyUnacknowledged()?"filter_list":"filter_list_off"),l(2),_(r.loading()?14:r.alerts().length===0?15:16))},dependencies:[U,$,R,H,L,N,j,J,q,V,K,G,Y,X,nt,et,tt,Z,st,ct,at,ot,lt,rt,W,Q,F,B],styles:[".alerts-panel[_ngcontent-%COMP%]{margin:16px 0}.alerts-panel[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.alerts-panel[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:500}.alerts-panel[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:28px;width:28px;height:28px}.alerts-panel[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.alerts-panel[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px}.loading-container[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 24px;text-align:center}.loading-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;opacity:.5;margin-bottom:16px}.loading-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;font-size:18px;font-weight:500}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;opacity:.7}.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]{margin-bottom:12px;box-shadow:0 2px 4px #0000001a;border-radius:8px;overflow:hidden}.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel.unacknowledged[_ngcontent-%COMP%]{border-left:4px solid #f44336;background-color:#fff3f3}.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]{padding:16px 24px}.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]   mat-panel-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]   mat-panel-title[_ngcontent-%COMP%]   .severity-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]   mat-panel-title[_ngcontent-%COMP%]   .alert-title[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]   mat-panel-description[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;justify-content:flex-end}.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]   mat-panel-description[_ngcontent-%COMP%]   .alert-time[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]   mat-panel-description[_ngcontent-%COMP%]   .acknowledged-chip[_ngcontent-%COMP%]{font-size:12px;height:24px}.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]   mat-panel-description[_ngcontent-%COMP%]   .acknowledged-chip[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;margin-right:4px}.alert-details[_ngcontent-%COMP%]{padding:16px 24px 24px}.alert-details[_ngcontent-%COMP%]   .alert-message[_ngcontent-%COMP%]{margin:0 0 16px;padding:12px;background-color:#f5f5f5;border-radius:4px;font-size:14px;line-height:1.5}.alert-details[_ngcontent-%COMP%]   .alert-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-bottom:16px}.alert-details[_ngcontent-%COMP%]   .alert-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:14px}.alert-details[_ngcontent-%COMP%]   .alert-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;opacity:.7}.alert-details[_ngcontent-%COMP%]   .alert-extra-details[_ngcontent-%COMP%]{margin:16px 0;padding:12px;background-color:#f9f9f9;border-radius:4px}.alert-details[_ngcontent-%COMP%]   .alert-extra-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;font-size:14px;font-weight:500}.alert-details[_ngcontent-%COMP%]   .alert-extra-details[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;font-size:12px;line-height:1.4;overflow-x:auto}.alert-details[_ngcontent-%COMP%]   .alert-actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:16px;padding-top:16px;border-top:1px solid #e0e0e0}.alert-details[_ngcontent-%COMP%]   .alert-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:4px}@media(max-width:768px){.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]   mat-panel-title[_ngcontent-%COMP%]   .alert-title[_ngcontent-%COMP%]{font-size:14px}.alerts-list[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]   mat-panel-description[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-end;gap:4px}.alert-details[_ngcontent-%COMP%]   .alert-actions[_ngcontent-%COMP%]{flex-direction:column}.alert-details[_ngcontent-%COMP%]   .alert-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"],changeDetection:0})}};export{dt as AlertsPanelComponent};
