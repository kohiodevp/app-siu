import{d as Xe}from"./chunk-YHXWWA2F.js";import{c as Ve}from"./chunk-L267FACM.js";import"./chunk-7UZYWCAJ.js";import{a as Re}from"./chunk-Q6MIBXXU.js";import{c as b,d as c,e as me,g as l,h as S,i as g,j as k,k as q}from"./chunk-OCAOS45R.js";import{d as ze,h as qe,i as Be}from"./chunk-474YFGF3.js";import{b as ke,c as Ie}from"./chunk-JBX6OC6U.js";import{a as Ae}from"./chunk-V6MGZ35S.js";import{b as we,d as Oe,e as Se,i as Te}from"./chunk-DEKAXLAX.js";import{a as De,b as Le}from"./chunk-GWNY4E3S.js";import"./chunk-MXRZJWAE.js";import"./chunk-3FMCGYQ4.js";import{a as Ge}from"./chunk-ISPOGFK5.js";import{a as Ne}from"./chunk-NQ5JYPMZ.js";import{a as R,b as X}from"./chunk-FJY5KO7T.js";import"./chunk-L64YGAYQ.js";import{a as ye,c as Pe,h as Ee}from"./chunk-HFRGPHGK.js";import{b as ce,d as C,g as de,h as pe,k as ue,l as ge,m as fe,n as he,o as be,p as Ce,r as Me,s as _e,t as ve,u as xe}from"./chunk-M2VBT7VT.js";import{a as I,b as F}from"./chunk-STMJJCCP.js";import{$ as V,W as B,Y as Fe}from"./chunk-ZNVG5ZVS.js";import{a as ie,c as re,d as le,g as se}from"./chunk-LMV7XNWS.js";import"./chunk-FBCHPQNP.js";import{n as oe,p as A}from"./chunk-YGREV7VD.js";import{Cb as f,Db as h,Gb as D,Hb as N,Ib as d,Jb as a,Kb as o,Lb as p,Sb as G,Wb as x,Xa as s,Yb as u,ac as Q,ba as y,bc as W,cc as ee,ga as w,ha as O,hc as te,ic as J,kc as r,lb as T,lc as _,mc as z,oa as Z,sa as v,wc as ne,yc as ae}from"./chunk-E7AQ6X4Y.js";import{a as H,b as U}from"./chunk-EQDQRRRY.js";var P="300ms cubic-bezier(0.0, 0.0, 0.2, 1)",$="200ms cubic-bezier(0.4, 0.0, 1, 1)",Je="250ms cubic-bezier(0.4, 0.0, 0.2, 1)",$e=b("fade",[g(":enter",[l({opacity:0}),c(P,l({opacity:1}))]),g(":leave",[c($,l({opacity:0}))])]),Et=b("slideInUp",[g(":enter",[l({transform:"translateY(20px)",opacity:0}),c(P,l({transform:"translateY(0)",opacity:1}))])]),wt=b("slideInDown",[g(":enter",[l({transform:"translateY(-20px)",opacity:0}),c(P,l({transform:"translateY(0)",opacity:1}))])]),Ot=b("slideInLeft",[g(":enter",[l({transform:"translateX(-20px)",opacity:0}),c(P,l({transform:"translateX(0)",opacity:1}))])]),St=b("slideInRight",[g(":enter",[l({transform:"translateX(20px)",opacity:0}),c(P,l({transform:"translateX(0)",opacity:1}))])]),Tt=b("scale",[g(":enter",[l({transform:"scale(0.95)",opacity:0}),c(P,l({transform:"scale(1)",opacity:1}))]),g(":leave",[c($,l({transform:"scale(0.95)",opacity:0}))])]),At=b("listStagger",[g("* => *",[k(":enter",[l({opacity:0,transform:"translateY(15px)"}),q("50ms",[c(P,l({opacity:1,transform:"translateY(0)"}))])],{optional:!0}),k(":leave",[q("30ms",[c($,l({opacity:0,transform:"translateY(-15px)"}))])],{optional:!0})])]),kt=b("cardGrid",[g("* => *",[k(":enter",[l({opacity:0,transform:"scale(0.9) translateY(20px)"}),q("80ms",[c("400ms cubic-bezier(0.0, 0.0, 0.2, 1)",l({opacity:1,transform:"scale(1) translateY(0)"}))])],{optional:!0})])]),It=b("expandCollapse",[S("collapsed",l({height:"0",overflow:"hidden",opacity:0})),S("expanded",l({height:"*",overflow:"visible",opacity:1})),g("collapsed <=> expanded",[c(Je)])]),Ft=b("routeAnimation",[g("* <=> *",[me([k(":enter",[l({position:"absolute",width:"100%",opacity:0,transform:"translateX(50px)"}),c(P,l({opacity:1,transform:"translateX(0)"}))],{optional:!0}),k(":leave",[l({position:"absolute",width:"100%"}),c($,l({opacity:0,transform:"translateX(-50px)"}))],{optional:!0})])])]),Dt=b("shake",[g("* => shake",[c("400ms cubic-bezier(0.36, 0.07, 0.19, 0.97)",l({transform:"translateX(0)"})),c("100ms",l({transform:"translateX(-10px)"})),c("100ms",l({transform:"translateX(10px)"})),c("100ms",l({transform:"translateX(-10px)"})),c("100ms",l({transform:"translateX(10px)"})),c("100ms",l({transform:"translateX(0)"}))])]),Lt=b("pulse",[S("default",l({transform:"scale(1)"})),S("pulse",l({transform:"scale(1)"})),g("* => pulse",[c("150ms ease-in",l({transform:"scale(1.1)"})),c("150ms ease-out",l({transform:"scale(1)"}))])]),Nt=b("bounce",[g(":enter",[l({transform:"scale(0)"}),c("600ms cubic-bezier(0.68, -0.55, 0.265, 1.55)",l({transform:"scale(1)"}))])]),Gt=b("highlight",[S("normal",l({backgroundColor:"transparent"})),S("highlighted",l({backgroundColor:"rgba(103, 58, 183, 0.1)"})),g("normal <=> highlighted",c("200ms ease-in-out"))]),zt=b("progress",[g(":enter",[l({width:"0%"}),c("800ms ease-out",l({width:"{{width}}"}))],{params:{width:"100%"}})]);function Qe(n,t){if(n&1&&(a(0,"div",0)(1,"mat-icon",1),r(2),o(),a(3,"span",2),r(4),o()()),n&2){let e=u();d("@fade",void 0),s(2),_(e.errorMessage.icon||"error"),s(2),_(e.errorMessage.message)}}var j=class n{constructor(){this.control=null;this.fieldName="Ce champ"}getErrorMessages(){return{required:()=>({type:"required",message:`${this.fieldName} est requis`,icon:"error_outline"}),email:()=>({type:"email",message:"Veuillez entrer une adresse email valide",icon:"alternate_email"}),minlength:t=>({type:"minlength",message:`Minimum ${t.requiredLength} caract\xE8res requis (${t.actualLength} actuellement)`,icon:"short_text"}),maxlength:t=>({type:"maxlength",message:`Maximum ${t.requiredLength} caract\xE8res autoris\xE9s`,icon:"text_fields"}),min:t=>({type:"min",message:`La valeur minimale est ${t.min}`,icon:"arrow_downward"}),max:t=>({type:"max",message:`La valeur maximale est ${t.max}`,icon:"arrow_upward"}),pattern:()=>({type:"pattern",message:`${this.fieldName} ne respecte pas le format attendu`,icon:"pattern"}),passwordMismatch:()=>({type:"passwordMismatch",message:"Les mots de passe ne correspondent pas",icon:"lock"}),invalidReference:()=>({type:"invalidReference",message:"R\xE9f\xE9rence cadastrale invalide",icon:"location_off"}),invalidCoordinates:()=>({type:"invalidCoordinates",message:"Coordonn\xE9es g\xE9ographiques invalides",icon:"wrong_location"}),futureDate:()=>({type:"futureDate",message:"La date ne peut pas \xEAtre dans le futur",icon:"event_busy"}),pastDate:()=>({type:"pastDate",message:"La date ne peut pas \xEAtre dans le pass\xE9",icon:"history"})}}shouldShowError(){return!!(this.control&&this.control.invalid&&(this.control.dirty||this.control.touched))}get errorMessage(){if(!this.control||!this.control.errors)return null;let t=this.control.errors,e=Object.keys(t)[0],m=this.getErrorMessages()[e];return m?m(t[e]):{type:e,message:`${this.fieldName} contient une erreur`,icon:"error"}}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=T({type:n,selectors:[["app-form-field-error"]],inputs:{control:"control",fieldName:"fieldName"},decls:1,vars:1,consts:[[1,"error-container"],[1,"error-icon"],[1,"error-text"]],template:function(e,i){e&1&&f(0,Qe,5,3,"div",0),e&2&&h(i.shouldShowError()&&i.errorMessage?0:-1)},dependencies:[A,F,I],styles:[".error-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem;margin-top:.25rem;background-color:#f443360d;border-left:3px solid #f44336;border-radius:4px;animation:_ngcontent-%COMP%_shake .4s cubic-bezier(.36,.07,.19,.97)}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}10%,30%,50%,70%,90%{transform:translate(-5px)}20%,40%,60%,80%{transform:translate(5px)}}.error-icon[_ngcontent-%COMP%]{font-size:1.25rem;width:1.25rem;height:1.25rem;color:#f44336;flex-shrink:0}.error-text[_ngcontent-%COMP%]{font-size:.875rem;color:#f44336;line-height:1.4}@media(prefers-color-scheme:dark){.error-container[_ngcontent-%COMP%]{background-color:#f4433626}}"],data:{animation:[$e]},changeDetection:0})}};var et=["mapContainer"],tt=(n,t)=>t.type;function nt(n,t){if(n&1){let e=G();a(0,"button",12),x("click",function(){let m=w(e).$implicit,M=u();return O(M.selectTool(m.type))}),a(1,"mat-icon"),r(2),o()()}if(n&2){let e=t.$implicit,i=u();J("active",i.currentTool()===e.type),d("matTooltip",e.label)("disabled",!i.editable),s(2),_(e.icon)}}function at(n,t){if(n&1&&(a(0,"div",9)(1,"mat-icon"),r(2,"crop_square"),o(),a(3,"div",13)(4,"span",14),r(5,"Surface calcul\xE9e:"),o(),a(6,"span",15),r(7),ne(8,"number"),o()()()),n&2){let e=u();s(7),z("",ae(8,1,e.calculatedArea(),"1.0-0")," m\xB2")}}function ot(n,t){n&1&&(a(0,"span"),r(1,"Cliquez pour dessiner les points du polygone. Double-cliquez pour terminer."),o())}function it(n,t){n&1&&(a(0,"span"),r(1,"Cliquez et glissez pour dessiner un rectangle."),o())}function rt(n,t){n&1&&(a(0,"span"),r(1,"Cliquez sur la carte pour placer un marqueur."),o())}function lt(n,t){n&1&&(a(0,"span"),r(1,"D\xE9placez les points pour modifier la forme."),o())}function st(n,t){n&1&&(a(0,"span"),r(1,"Cliquez sur Supprimer pour effacer la g\xE9om\xE9trie."),o())}function mt(n,t){if(n&1&&(a(0,"div",11)(1,"mat-icon"),r(2,"info"),o(),f(3,ot,2,0,"span")(4,it,2,0,"span")(5,rt,2,0,"span")(6,lt,2,0,"span")(7,st,2,0,"span"),o()),n&2){let e,i=u();s(3),h((e=i.currentTool())==="polygon"?3:e==="rectangle"?4:e==="marker"?5:e==="edit"?6:e==="delete"?7:-1)}}var K=class n{constructor(){this.center=[45.75,4.85];this.zoom=13;this.editable=!0;this.geometryChanged=new Z;this.areaCalculated=new Z;this.snackBar=y(R);this.currentTool=v("none");this.calculatedArea=v(0);this.showMeasurements=v(!0);this.tools=[{type:"polygon",label:"Polygone",icon:"crop_square"},{type:"rectangle",label:"Rectangle",icon:"crop_3_2"},{type:"marker",label:"Point",icon:"place"},{type:"edit",label:"\xC9diter",icon:"edit"},{type:"delete",label:"Supprimer",icon:"delete"}]}ngOnInit(){this.loadLeaflet()}ngAfterViewInit(){setTimeout(()=>{this.initMap()},100)}ngOnDestroy(){this.map&&this.map.remove()}loadLeaflet(){typeof L>"u"&&console.warn("Leaflet not loaded. Please include leaflet.js in your project.")}initMap(){if(!this.mapContainer){console.error("Map container not found");return}this.map=L.map(this.mapContainer.nativeElement,{center:this.center,zoom:this.zoom,zoomControl:!0}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors",maxZoom:19}).addTo(this.map),this.drawnItems=L.featureGroup().addTo(this.map),this.initialGeometry&&this.loadGeometry(this.initialGeometry),this.editable&&this.setupDrawingTools(),this.setupEventListeners()}setupDrawingTools(){this.map.on("draw:created",t=>{let e=t.layer;this.drawnItems.addLayer(e),this.onGeometryCreated(e)}),this.map.on("draw:edited",t=>{this.onGeometryEdited()}),this.map.on("draw:deleted",t=>{this.onGeometryDeleted()})}setupEventListeners(){this.map.on("click",t=>{this.currentTool()==="marker"&&this.addMarker(t.latlng)})}loadGeometry(t){let e;if(t.type==="Polygon"){let i=t.coordinates.map(m=>[m[1],m[0]]);e=L.polygon(i)}else if(t.type==="Point"){let i=t.coordinates;e=L.marker([i[1],i[0]])}e&&(this.drawnItems.addLayer(e),this.map.fitBounds(this.drawnItems.getBounds()),this.calculateArea())}selectTool(t){switch(this.currentTool.set(t),this.cancelCurrentDrawing(),t){case"polygon":this.startDrawingPolygon();break;case"rectangle":this.startDrawingRectangle();break;case"edit":this.enableEditMode();break;case"delete":this.enableDeleteMode();break;case"marker":this.snackBar.open("Cliquez sur la carte pour placer un marqueur","OK",{duration:3e3});break}}startDrawingPolygon(){this.currentDrawing=new L.Draw.Polygon(this.map,{shapeOptions:{color:"#2196f3",weight:3}}),this.currentDrawing.enable(),this.snackBar.open("Cliquez pour dessiner les points du polygone. Double-cliquez pour terminer.","OK",{duration:5e3})}startDrawingRectangle(){this.currentDrawing=new L.Draw.Rectangle(this.map,{shapeOptions:{color:"#2196f3",weight:3}}),this.currentDrawing.enable(),this.snackBar.open("Cliquez et glissez pour dessiner un rectangle","OK",{duration:3e3})}addMarker(t){this.drawnItems.eachLayer(i=>{i instanceof L.Marker&&this.drawnItems.removeLayer(i)});let e=L.marker(t);this.drawnItems.addLayer(e),this.emitGeometry(),this.currentTool.set("none")}enableEditMode(){if(this.drawnItems.getLayers().length===0){this.snackBar.open("Aucune g\xE9om\xE9trie \xE0 \xE9diter","OK",{duration:3e3}),this.currentTool.set("none");return}this.drawnItems.eachLayer(t=>{t.editing&&t.editing.enable()}),this.snackBar.open("Mode \xE9dition activ\xE9. D\xE9placez les points pour modifier la forme.","OK",{duration:3e3})}enableDeleteMode(){if(this.drawnItems.getLayers().length===0){this.snackBar.open("Aucune g\xE9om\xE9trie \xE0 supprimer","OK",{duration:3e3}),this.currentTool.set("none");return}confirm("\xCAtes-vous s\xFBr de vouloir supprimer la g\xE9om\xE9trie ?")&&(this.drawnItems.clearLayers(),this.emitGeometry(),this.calculatedArea.set(0),this.areaCalculated.emit(0)),this.currentTool.set("none")}cancelCurrentDrawing(){this.currentDrawing&&(this.currentDrawing.disable(),this.currentDrawing=null),this.drawnItems.eachLayer(t=>{t.editing&&t.editing.disable()})}onGeometryCreated(t){this.currentTool.set("none"),this.calculateArea(),this.emitGeometry(),this.snackBar.open("G\xE9om\xE9trie cr\xE9\xE9e avec succ\xE8s","OK",{duration:2e3})}onGeometryEdited(){this.calculateArea(),this.emitGeometry(),this.snackBar.open("G\xE9om\xE9trie modifi\xE9e","OK",{duration:2e3})}onGeometryDeleted(){this.calculatedArea.set(0),this.areaCalculated.emit(0),this.emitGeometry(),this.snackBar.open("G\xE9om\xE9trie supprim\xE9e","OK",{duration:2e3})}calculateArea(){let t=0;this.drawnItems.eachLayer(e=>{if(e instanceof L.Polygon||e instanceof L.Rectangle){let i=e.getLatLngs()[0];t+=L.GeometryUtil.geodesicArea(i)}}),this.calculatedArea.set(Math.round(t)),this.areaCalculated.emit(this.calculatedArea())}emitGeometry(){let t=this.drawnItems.getLayers();if(t.length===0){this.geometryChanged.emit({type:"Polygon",coordinates:[]});return}let e=t[0];if(e instanceof L.Marker){let i=e.getLatLng();this.geometryChanged.emit({type:"Point",coordinates:[i.lng,i.lat]})}else if(e instanceof L.Polygon||e instanceof L.Rectangle){let m=e.getLatLngs()[0].map(M=>[M.lng,M.lat]);this.geometryChanged.emit({type:"Polygon",coordinates:[m]})}}clearAll(){confirm("\xCAtes-vous s\xFBr de vouloir tout effacer ?")&&(this.drawnItems.clearLayers(),this.calculatedArea.set(0),this.areaCalculated.emit(0),this.emitGeometry(),this.currentTool.set("none"))}fitBounds(){this.drawnItems.getLayers().length>0&&this.map.fitBounds(this.drawnItems.getBounds())}toggleMeasurements(){this.showMeasurements.set(!this.showMeasurements())}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=T({type:n,selectors:[["app-map-editor"]],viewQuery:function(e,i){if(e&1&&Q(et,5),e&2){let m;W(m=ee())&&(i.mapContainer=m.first)}},inputs:{initialGeometry:"initialGeometry",center:"center",zoom:"zoom",editable:"editable"},outputs:{geometryChanged:"geometryChanged",areaCalculated:"areaCalculated"},decls:25,vars:5,consts:[["mapContainer",""],[1,"map-editor"],[1,"editor-toolbar"],[1,"toolbar-section"],[1,"tools-group"],["mat-icon-button","",3,"active","matTooltip","disabled"],["mat-icon-button","","matTooltip","Centrer sur la g\xE9om\xE9trie",3,"click"],["mat-icon-button","","matTooltip","Afficher/Masquer les mesures",3,"click"],["mat-icon-button","","matTooltip","Tout effacer","color","warn",3,"click","disabled"],[1,"toolbar-section","area-display"],[1,"map-container"],[1,"instructions"],["mat-icon-button","",3,"click","matTooltip","disabled"],[1,"area-info"],[1,"area-label"],[1,"area-value"]],template:function(e,i){if(e&1){let m=G();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3"),r(4,"Outils de dessin"),o(),a(5,"div",4),D(6,nt,3,5,"button",5,tt),o()(),a(8,"div",3)(9,"h3"),r(10,"Actions"),o(),a(11,"div",4)(12,"button",6),x("click",function(){return w(m),O(i.fitBounds())}),a(13,"mat-icon"),r(14,"center_focus_strong"),o()(),a(15,"button",7),x("click",function(){return w(m),O(i.toggleMeasurements())}),a(16,"mat-icon"),r(17,"straighten"),o()(),a(18,"button",8),x("click",function(){return w(m),O(i.clearAll())}),a(19,"mat-icon"),r(20,"delete_sweep"),o()()()(),f(21,at,9,4,"div",9),o(),p(22,"div",10,0),f(24,mt,8,1,"div",11),o()}e&2&&(s(6),N(i.tools),s(9),J("active",i.showMeasurements()),s(3),d("disabled",!i.editable),s(3),h(i.calculatedArea()>0&&i.showMeasurements()?21:-1),s(3),h(i.editable&&i.currentTool()!=="none"?24:-1))},dependencies:[A,V,B,F,I,Ge,Ne,X,Ve,ve,oe],styles:[".map-editor[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;position:relative;border:1px solid #e0e0e0;border-radius:8px;overflow:hidden;background-color:#fff}.editor-toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:24px;padding:12px 16px;background-color:#f5f5f5;border-bottom:1px solid #e0e0e0;flex-wrap:wrap}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 8px 0 0;font-size:14px;font-weight:500;color:#666}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section[_ngcontent-%COMP%]   .tools-group[_ngcontent-%COMP%]{display:flex;gap:4px}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section[_ngcontent-%COMP%]   .tools-group[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#2196f3;color:#fff}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section[_ngcontent-%COMP%]   .tools-group[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#fff}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section[_ngcontent-%COMP%]   .tools-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#e0e0e0}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section[_ngcontent-%COMP%]   .tools-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section.area-display[_ngcontent-%COMP%]{margin-left:auto;background-color:#e3f2fd;padding:8px 16px;border-radius:20px;gap:12px}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section.area-display[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#2196f3;font-size:20px;width:20px;height:20px}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section.area-display[_ngcontent-%COMP%]   .area-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section.area-display[_ngcontent-%COMP%]   .area-info[_ngcontent-%COMP%]   .area-label[_ngcontent-%COMP%]{font-size:11px;color:#666;text-transform:uppercase;font-weight:500}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section.area-display[_ngcontent-%COMP%]   .area-info[_ngcontent-%COMP%]   .area-value[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#2196f3}.map-container[_ngcontent-%COMP%]{flex:1;min-height:400px;position:relative;z-index:1}.map-container   [_nghost-%COMP%]     .leaflet-container{height:100%;width:100%;font-family:inherit}.map-container   [_nghost-%COMP%]     .leaflet-control-zoom{border:2px solid rgba(0,0,0,.2);border-radius:4px}.map-container   [_nghost-%COMP%]     .leaflet-bar a{color:#333}.map-container   [_nghost-%COMP%]     .leaflet-bar a:hover{background-color:#f4f4f4}.map-container   [_nghost-%COMP%]     .leaflet-draw-tooltip{background-color:#000c;color:#fff;padding:8px 12px;border-radius:4px;font-size:13px}.map-container   [_nghost-%COMP%]     .leaflet-vertex-icon{border-radius:50%;width:12px;height:12px;background:#fff;border:2px solid #2196f3}.map-container   [_nghost-%COMP%]     .leaflet-middle-icon{width:8px;height:8px;background:#2196f3;border-radius:50%}.instructions[_ngcontent-%COMP%]{position:absolute;bottom:24px;left:50%;transform:translate(-50%);background-color:#000c;color:#fff;padding:12px 20px;border-radius:24px;display:flex;align-items:center;gap:12px;font-size:14px;z-index:1000;box-shadow:0 4px 8px #0000004d;animation:_ngcontent-%COMP%_slideUp .3s ease-out}.instructions[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;color:#4caf50}.instructions[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translate(-50%) translateY(20px)}to{opacity:1;transform:translate(-50%) translateY(0)}}@media(max-width:768px){.editor-toolbar[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section[_ngcontent-%COMP%]{width:100%}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section.area-display[_ngcontent-%COMP%]{margin-left:0}.editor-toolbar[_ngcontent-%COMP%]   .toolbar-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{display:none}.map-container[_ngcontent-%COMP%]{min-height:300px}.instructions[_ngcontent-%COMP%]{bottom:16px;left:16px;right:16px;transform:none;font-size:12px;padding:10px 16px}}"],changeDetection:0})}};var He=(n,t)=>t.value;function ct(n,t){if(n&1&&p(0,"app-form-field-error",8),n&2){let e=u();d("control",e.parcelForm.get("reference"))("fieldName","La r\xE9f\xE9rence")}}function dt(n,t){if(n&1&&p(0,"app-form-field-error",8),n&2){let e=u();d("control",e.parcelForm.get("address"))("fieldName","L'adresse")}}function pt(n,t){if(n&1&&p(0,"app-form-field-error",8),n&2){let e=u();d("control",e.parcelForm.get("area"))("fieldName","La superficie")}}function ut(n,t){if(n&1&&p(0,"app-form-field-error",8),n&2){let e=u();d("control",e.parcelForm.get("zone"))("fieldName","La zone")}}function gt(n,t){if(n&1&&(a(0,"mat-option",14),r(1),o()),n&2){let e=t.$implicit;d("value",e.value),s(),z(" ",e.label," ")}}function ft(n,t){if(n&1&&(a(0,"mat-option",14)(1,"span"),r(2),o()()),n&2){let e=t.$implicit;d("value",e.value),s(),te("color",e.color),s(),_(e.label)}}function ht(n,t){if(n&1&&p(0,"app-form-field-error",8),n&2){let e=u();d("control",e.parcelForm.get("latitude"))("fieldName","La latitude")}}function bt(n,t){if(n&1&&p(0,"app-form-field-error",8),n&2){let e=u();d("control",e.parcelForm.get("longitude"))("fieldName","La longitude")}}function Ct(n,t){if(n&1&&p(0,"app-form-field-error",8),n&2){let e=u();d("control",e.parcelForm.get("description"))("fieldName","La description")}}function Mt(n,t){if(n&1){let e=G();a(0,"div",22)(1,"app-map-editor",26),x("geometryChange",function(m){w(e);let M=u();return O(M.onGeometryChange(m))}),o(),a(2,"p",27)(3,"mat-icon"),r(4,"info"),o(),r(5," Utilisez les outils de dessin pour d\xE9finir la g\xE9om\xE9trie de la parcelle. Les coordonn\xE9es seront automatiquement mises \xE0 jour. "),o()()}if(n&2){let e,i=u();s(),d("initialGeometry",(e=i.parcelForm.get("geometry"))==null?null:e.value)}}function _t(n,t){n&1&&(a(0,"button",25),p(1,"mat-spinner",28),a(2,"span"),r(3,"Enregistrement..."),o()()),n&2&&d("disabled",!0)}function vt(n,t){if(n&1&&(a(0,"button",25)(1,"mat-icon"),r(2,"save"),o(),a(3,"span"),r(4),o()()),n&2){let e=u();d("disabled",e.parcelForm.invalid),s(4),_(e.isEditMode()?"Modifier":"Cr\xE9er")}}var Ue=class n{constructor(){this.fb=y(_e);this.route=y(ie);this.router=y(re);this.parcelService=y(Re);this.snackBar=y(R);this.loading=v(!1);this.submitting=v(!1);this.saving=v(!1);this.isEditMode=v(!1);this.parcelId=null;this.statusOptions=[{value:"available",label:"Disponible",color:"#4caf50"},{value:"occupied",label:"Occup\xE9e",color:"#ff9800"},{value:"disputed",label:"Contest\xE9e",color:"#f44336"},{value:"reserved",label:"R\xE9serv\xE9e",color:"#2196f3"}];this.categoryOptions=[{value:"residential",label:"R\xE9sidentiel"},{value:"commercial",label:"Commercial"},{value:"industrial",label:"Industriel"},{value:"agricultural",label:"Agricole"},{value:"mixed-use",label:"Mixte"},{value:"public-space",label:"Espace public"},{value:"Habitation",label:"Habitation"},{value:"CTOM",label:"CTOM"},{value:"Gendarmerie",label:"Gendarmerie"},{value:"Police",label:"Police"},{value:"CSPS",label:"CSPS"},{value:"CMA",label:"CMA"},{value:"CEEP",label:"CEEP"},{value:"Ecole primaire",label:"\xC9cole primaire"},{value:"Ecole secondaire",label:"\xC9cole secondaire"},{value:"Enseignement secondaire",label:"Enseignement secondaire"},{value:"Complexe scolaire",label:"Complexe scolaire"},{value:"Jardin d'enfants",label:"Jardin d'enfants"},{value:"Sante",label:"Sant\xE9"},{value:"Forage",label:"Forage"},{value:"Fontaine",label:"Fontaine"},{value:"Chateau d'eau",label:"Ch\xE2teau d'eau"},{value:"Mosquee",label:"Mosqu\xE9e"},{value:"Eglise catholique",label:"\xC9glise catholique"},{value:"Culte",label:"Lieu de culte"},{value:"Cimetiere",label:"Cimeti\xE8re"},{value:"Cimetiere catholique",label:"Cimeti\xE8re catholique"},{value:"Lieu sacre",label:"Lieu sacr\xE9"},{value:"Place publique",label:"Place publique"},{value:"Jardin public",label:"Jardin public"},{value:"Terrain de sport",label:"Terrain de sport"},{value:"Plateau omnisports",label:"Plateau omnisports"},{value:"Aire de jeux",label:"Aire de jeux"},{value:"Aire de stationnement",label:"Aire de stationnement"},{value:"Village traditionnel",label:"Village traditionnel"},{value:"Habitat collectif",label:"Habitat collectif"},{value:"Domaine prive",label:"Domaine priv\xE9"},{value:"Servitude haute tension",label:"Servitude HT"},{value:"Centre commercial",label:"Centre commercial"},{value:"Grand marche",label:"Grand march\xE9"},{value:"Marche",label:"March\xE9"},{value:"Station service",label:"Station service"},{value:"Gare routiere",label:"Gare routi\xE8re"},{value:"Maison de la femme",label:"Maison de la femme"},{value:"Maison des jeunes",label:"Maison des jeunes"},{value:"Association Woroyire",label:"Association Woroyire"},{value:"Association lolo",label:"Association lolo"},{value:"Groupement Darsalam",label:"Groupement Darsalam"},{value:"ZNA",label:"ZNA"},{value:"DT",label:"DT"},{value:"RA",label:"RA"},{value:"RF",label:"RF"},{value:"EV",label:"EV"},{value:"Indefini",label:"Ind\xE9fini"}];this.parcelForm=this.fb.nonNullable.group({reference:["",[C.required,C.minLength(3)]],address:["",C.required],area:[null,[C.required,C.min(1)]],zone:["",C.required],category:["",C.required],status:["available",C.required],latitude:[null,[C.min(-90),C.max(90)]],longitude:[null,[C.min(-180),C.max(180)]],description:["",C.maxLength(500)],geometry:[null]});this.showMap=v(!1)}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t&&(this.isEditMode.set(!0),this.parcelId=t,this.loadParcel(this.parcelId))}loadParcel(t){this.loading.set(!0),this.parcelService.getParcel(t).subscribe({next:e=>{this.parcelForm.patchValue(U(H({},e),{category:e.category||""})),this.loading.set(!1)},error:()=>{this.loading.set(!1),this.snackBar.open("Erreur lors du chargement","Fermer",{duration:3e3})}})}onSubmit(){if(this.parcelForm.invalid)return;this.saving.set(!0),this.submitting.set(!0);let t=this.parcelForm.getRawValue(),e=U(H({},t),{category:t.category||void 0});(this.isEditMode()?this.parcelService.updateParcel(this.parcelId,e):this.parcelService.createParcel(e)).subscribe({next:()=>{this.snackBar.open("Parcelle enregistr\xE9e avec succ\xE8s","Fermer",{duration:3e3}),this.router.navigate(["/parcels"])},error:()=>{this.saving.set(!1),this.submitting.set(!1),this.snackBar.open("Erreur lors de l'enregistrement","Fermer",{duration:3e3})}})}cancel(){this.router.navigate(["/parcels"])}onGeometryChange(t){if(this.parcelForm.patchValue({geometry:t}),t&&t.type==="Polygon"&&t.coordinates[0]){let e=t.coordinates[0],i=e.map(E=>E[1]),m=e.map(E=>E[0]),M=i.reduce((E,Y)=>E+Y,0)/i.length,Ze=m.reduce((E,Y)=>E+Y,0)/m.length;this.parcelForm.patchValue({latitude:M,longitude:Ze}),this.snackBar.open("G\xE9om\xE9trie mise \xE0 jour","OK",{duration:2e3})}}toggleMap(){this.showMap.update(t=>!t)}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=T({type:n,selectors:[["app-parcel-form"]],decls:102,vars:14,consts:[[1,"parcel-form-container"],[1,"header"],["mat-icon-button","","routerLink","/parcels"],[3,"ngSubmit","formGroup"],[1,"form-grid"],["appearance","outline",1,"full-width"],["matInput","","formControlName","reference","placeholder","Ex: PAR-001"],["matPrefix",""],[3,"control","fieldName"],["matInput","","formControlName","address","placeholder","Adresse compl\xE8te de la parcelle"],["appearance","outline"],["matInput","","type","number","formControlName","area","placeholder","0","min","1"],["matInput","","formControlName","zone","placeholder","Ex: Zone A"],["formControlName","category"],[3,"value"],["formControlName","status"],["matInput","","type","number","formControlName","latitude","placeholder","0.0","step","0.000001","min","-90","max","90"],["matInput","","type","number","formControlName","longitude","placeholder","0.0","step","0.000001","min","-180","max","180"],["matInput","","formControlName","description","rows","4","placeholder","Description d\xE9taill\xE9e de la parcelle","maxlength","500"],["align","end"],[1,"geometry-section","full-width"],["type","button","mat-raised-button","","color","accent",3,"click"],[1,"map-container",2,"height","500px"],[1,"form-actions"],["type","button","mat-button","","routerLink","/parcels"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],[3,"geometryChange","initialGeometry"],[1,"map-hint"],["diameter","20"]],template:function(e,i){if(e&1&&(a(0,"div",0)(1,"div",1)(2,"button",2)(3,"mat-icon"),r(4,"arrow_back"),o()(),a(5,"h1"),r(6),o()(),a(7,"mat-card")(8,"mat-card-content")(9,"form",3),x("ngSubmit",function(){return i.onSubmit()}),a(10,"div",4)(11,"mat-form-field",5)(12,"mat-label"),r(13,"R\xE9f\xE9rence cadastrale *"),o(),p(14,"input",6),a(15,"mat-icon",7),r(16,"tag"),o(),a(17,"mat-hint"),r(18,"Format: 3 caract\xE8res minimum"),o()(),f(19,ct,1,2,"app-form-field-error",8),a(20,"mat-form-field",5)(21,"mat-label"),r(22,"Adresse *"),o(),p(23,"input",9),a(24,"mat-icon",7),r(25,"place"),o(),a(26,"mat-hint"),r(27,"Saisissez l'adresse compl\xE8te"),o()(),f(28,dt,1,2,"app-form-field-error",8),a(29,"mat-form-field",10)(30,"mat-label"),r(31,"Superficie (m\xB2) *"),o(),p(32,"input",11),a(33,"mat-icon",7),r(34,"square_foot"),o(),a(35,"mat-hint"),r(36,"En m\xE8tres carr\xE9s"),o()(),f(37,pt,1,2,"app-form-field-error",8),a(38,"mat-form-field",10)(39,"mat-label"),r(40,"Zone *"),o(),p(41,"input",12),a(42,"mat-icon",7),r(43,"location_city"),o(),a(44,"mat-hint"),r(45,"Zone cadastrale"),o()(),f(46,ut,1,2,"app-form-field-error",8),a(47,"mat-form-field",10)(48,"mat-label"),r(49,"Cat\xE9gorie *"),o(),a(50,"mat-select",13),D(51,gt,2,2,"mat-option",14,He),o(),a(53,"mat-icon",7),r(54,"category"),o()(),a(55,"mat-form-field",10)(56,"mat-label"),r(57,"Statut *"),o(),a(58,"mat-select",15),D(59,ft,3,4,"mat-option",14,He),o(),a(61,"mat-icon",7),r(62,"info"),o()(),a(63,"mat-form-field",10)(64,"mat-label"),r(65,"Latitude"),o(),p(66,"input",16),a(67,"mat-icon",7),r(68,"my_location"),o(),a(69,"mat-hint"),r(70,"Entre -90 et 90"),o()(),f(71,ht,1,2,"app-form-field-error",8),a(72,"mat-form-field",10)(73,"mat-label"),r(74,"Longitude"),o(),p(75,"input",17),a(76,"mat-icon",7),r(77,"my_location"),o(),a(78,"mat-hint"),r(79,"Entre -180 et 180"),o()(),f(80,bt,1,2,"app-form-field-error",8),a(81,"mat-form-field",5)(82,"mat-label"),r(83,"Description"),o(),p(84,"textarea",18),a(85,"mat-icon",7),r(86,"description"),o(),a(87,"mat-hint",19),r(88),o()(),f(89,Ct,1,2,"app-form-field-error",8),o(),a(90,"div",20)(91,"button",21),x("click",function(){return i.toggleMap()}),a(92,"mat-icon"),r(93),o(),a(94,"span"),r(95),o()(),f(96,Mt,6,1,"div",22),o(),a(97,"div",23)(98,"button",24),r(99," Annuler "),o(),f(100,_t,4,1,"button",25)(101,vt,5,2,"button",25),o()()()()()),e&2){let m;s(6),_(i.isEditMode()?"Modifier la parcelle":"Nouvelle parcelle"),s(3),d("formGroup",i.parcelForm),s(10),h(i.parcelForm.get("reference")?19:-1),s(9),h(i.parcelForm.get("address")?28:-1),s(9),h(i.parcelForm.get("area")?37:-1),s(9),h(i.parcelForm.get("zone")?46:-1),s(5),N(i.categoryOptions),s(8),N(i.statusOptions),s(12),h(i.parcelForm.get("latitude")?71:-1),s(9),h(i.parcelForm.get("longitude")?80:-1),s(8),z("",((m=i.parcelForm.get("description"))==null||m.value==null?null:m.value.length)||0," / 500"),s(),h(i.parcelForm.get("description")?89:-1),s(4),_(i.showMap()?"map_off":"map"),s(2),_(i.showMap()?"Masquer la carte":"Dessiner sur la carte"),s(),h(i.showMap()?96:-1),s(4),h(i.saving()?100:101)}},dependencies:[A,xe,ue,ce,ge,de,pe,Me,Ce,be,he,fe,se,le,Ee,ye,Pe,Ae,Te,we,Oe,Se,Ie,ke,Be,qe,ze,V,Fe,B,F,I,Le,De,X,Xe,j,K],styles:[".parcel-form-container[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:2rem}.parcel-form-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:2rem}.parcel-form-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;font-weight:500}.parcel-form-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{box-shadow:0 2px 8px #0000001a}.parcel-form-container[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem;margin-bottom:2rem}.parcel-form-container[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{grid-column:1/-1}.parcel-form-container[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;padding-top:1rem;border-top:1px solid rgba(0,0,0,.12)}.parcel-form-container[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:120px}.parcel-form-container[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{display:inline-block;margin-right:.5rem}@media(max-width:768px){.parcel-form-container[_ngcontent-%COMP%]{padding:1rem}.parcel-form-container[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"],changeDetection:0})}};export{Ue as ParcelFormComponent};
